/*! For license information please see xeokit-convert.cjs.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.convert2xkt=t():e.convert2xkt=t()}(global,(()=>(()=>{"use strict";var e={231:e=>{e.exports=require("fs")}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{r.r(n),r.d(n,{ClampToEdgeWrapping:()=>p,GIFMediaType:()=>O,JPEGMediaType:()=>L,LinearFilter:()=>M,LinearMipMapLinearFilter:()=>S,LinearMipMapNearestFilter:()=>T,LinearMipmapLinearFilter:()=>A,LinearMipmapNearestFilter:()=>I,MirroredRepeatWrapping:()=>m,NearestFilter:()=>y,NearestMipMapLinearFilter:()=>b,NearestMipMapNearestFilter:()=>g,NearestMipmapLinearFilter:()=>w,NearestMipmapNearestFilter:()=>x,PNGMediaType:()=>P,RepeatWrapping:()=>d,XKTModel:()=>Re,XKT_INFO:()=>f,buildBoxGeometry:()=>Nr,buildBoxLinesGeometry:()=>Vr,buildCylinderGeometry:()=>Cr,buildGridGeometry:()=>Br,buildPlaneGeometry:()=>Ur,buildSphereGeometry:()=>zr,buildTorusGeometry:()=>Xr,buildVectorTextGeometry:()=>Kr,convert2xkt:()=>Jr,parseCityJSONIntoXKTModel:()=>Pt,parseGLTFIntoXKTModel:()=>Bt,parseGLTFJSONIntoXKTModel:()=>Jt,parseIFCIntoXKTModel:()=>ar,parseLASIntoXKTModel:()=>hr,parseMetaModelIntoXKTModel:()=>vr,parsePCDIntoXKTModel:()=>mr,parsePLYIntoXKTModel:()=>Mr,parseSTLIntoXKTModel:()=>Lr,writeXKTModelToArrayBuffer:()=>Ze});const e=require("@loaders.gl/polyfills");var t,i,o,a,s,u,c,l,h,f={xktVersion:10},d=1e3,p=1001,m=1002,y=1003,g=1004,x=1004,w=1005,b=1005,M=1006,I=1007,T=1007,A=1008,S=1008,O=1e4,L=10001,P=10002,E=Float64Array,j=new E(16),G=new E(16),_=new E(4),k={MIN_DOUBLE:-Number.MAX_SAFE_INTEGER,MAX_DOUBLE:Number.MAX_SAFE_INTEGER,DEGTORAD:.0174532925,RADTODEG:57.295779513,vec2:function(e){return new E(e||2)},vec3:function(e){return new E(e||3)},vec4:function(e){return new E(e||4)},mat3:function(e){return new E(e||9)},mat3ToMat4:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4:function(e){return new E(e||16)},mat4ToMat3:function(e,t){},createUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return"".concat(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255],"-").concat(e[255&r]).concat(e[r>>8&255],"-").concat(e[r>>16&15|64]).concat(e[r>>24&255],"-").concat(e[63&n|128]).concat(e[n>>8&255],"-").concat(e[n>>16&255]).concat(e[n>>24&255]).concat(e[255&i]).concat(e[i>>8&255]).concat(e[i>>16&255]).concat(e[i>>24&255])}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},fmod:function(e,t){if(e<t)return console.error("math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),e;for(;t<=e;)e-=t;return e},negateVec4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},addVec4:function(e,t,r){return r||(r=e),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r},addVec4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r[3]=e[3]+t,r},addVec3:function(e,t,r){return r||(r=e),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r},addVec3Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r},subVec4:function(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r},subVec3:function(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r},subVec2:function(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r},subVec4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]-t,r[3]=e[3]-t,r},subScalarVec4:function(e,t,r){return r||(r=e),r[0]=t-e[0],r[1]=t-e[1],r[2]=t-e[2],r[3]=t-e[3],r},mulVec4:function(e,t,r){return r||(r=e),r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r},mulVec4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r},mulVec3Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r},mulVec2Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r},divVec3:function(e,t,r){return r||(r=e),r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r},divVec4:function(e,t,r){return r||(r=e),r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r[3]=e[3]/t[3],r},divScalarVec3:function(e,t,r){return r||(r=t),r[0]=e/t[0],r[1]=e/t[1],r[2]=e/t[2],r},divVec3Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]/t,r[1]=e[1]/t,r[2]=e[2]/t,r},divVec4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]/t,r[1]=e[1]/t,r[2]=e[2]/t,r[3]=e[3]/t,r},divScalarVec4:function(e,t,r){return r||(r=t),r[0]=e/t[0],r[1]=e/t[1],r[2]=e/t[2],r[3]=e/t[3],r},dotVec4:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},cross3Vec4:function(e,t){var r=e[0],n=e[1],i=e[2],o=t[0],a=t[1],s=t[2];return[n*s-i*a,i*o-r*s,r*a-n*o,0]},cross3Vec3:function(e,t,r){r||(r=e);var n=e[0],i=e[1],o=e[2],a=t[0],s=t[1],u=t[2];return r[0]=i*u-o*s,r[1]=o*a-n*u,r[2]=n*s-i*a,r},sqLenVec4:function(e){return k.dotVec4(e,e)},lenVec4:function(e){return Math.sqrt(k.sqLenVec4(e))},dotVec3:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},dotVec2:function(e,t){return e[0]*t[0]+e[1]*t[1]},sqLenVec3:function(e){return k.dotVec3(e,e)},sqLenVec2:function(e){return k.dotVec2(e,e)},lenVec3:function(e){return Math.sqrt(k.sqLenVec3(e))},distVec3:(c=new E(3),function(e,t){return k.lenVec3(k.subVec3(e,t,c))}),lenVec2:function(e){return Math.sqrt(k.sqLenVec2(e))},distVec2:function(){var e=new E(2);return function(t,r){return k.lenVec2(k.subVec2(t,r,e))}}(),rcpVec3:function(e,t){return k.divScalarVec3(1,e,t)},normalizeVec4:function(e,t){var r=1/k.lenVec4(e);return k.mulVec4Scalar(e,r,t)},normalizeVec3:function(e,t){var r=1/k.lenVec3(e);return k.mulVec3Scalar(e,r,t)},normalizeVec2:function(e,t){var r=1/k.lenVec2(e);return k.mulVec2Scalar(e,r,t)},angleVec3:function(e,t){var r=k.dotVec3(e,t)/Math.sqrt(k.sqLenVec3(e)*k.sqLenVec3(t));return r=r<-1?-1:r>1?1:r,Math.acos(r)},vec3FromMat4Scale:(u=new E(3),function(e,t){return u[0]=e[0],u[1]=e[1],u[2]=e[2],t[0]=k.lenVec3(u),u[0]=e[4],u[1]=e[5],u[2]=e[6],t[1]=k.lenVec3(u),u[0]=e[8],u[1]=e[9],u[2]=e[10],t[2]=k.lenVec3(u),t}),vecToArray:function(){function e(e){return Math.round(1e5*e)/1e5}return function(t){for(var r=0,n=(t=Array.prototype.slice.call(t)).length;r<n;r++)t[r]=e(t[r]);return t}}(),xyzArrayToObject:function(e){return{x:e[0],y:e[1],z:e[2]}},xyzObjectToArray:function(e,t){return(t=t||new E(3))[0]=e.x,t[1]=e.y,t[2]=e.z,t},dupMat4:function(e){return e.slice(0,16)},mat4To3:function(e){return[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]},m4s:function(e){return[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]},setMat4ToZeroes:function(){return k.m4s(0)},setMat4ToOnes:function(){return k.m4s(1)},diagonalMat4v:function(e){return new E([e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,e[3]])},diagonalMat4c:function(e,t,r,n){return k.diagonalMat4v([e,t,r,n])},diagonalMat4s:function(e){return k.diagonalMat4c(e,e,e,e)},identityMat4:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new E(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},identityMat3:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new E(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},isIdentityMat4:function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},negateMat4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},addMat4:function(e,t,r){return r||(r=e),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r[9]=e[9]+t[9],r[10]=e[10]+t[10],r[11]=e[11]+t[11],r[12]=e[12]+t[12],r[13]=e[13]+t[13],r[14]=e[14]+t[14],r[15]=e[15]+t[15],r},addMat4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r[3]=e[3]+t,r[4]=e[4]+t,r[5]=e[5]+t,r[6]=e[6]+t,r[7]=e[7]+t,r[8]=e[8]+t,r[9]=e[9]+t,r[10]=e[10]+t,r[11]=e[11]+t,r[12]=e[12]+t,r[13]=e[13]+t,r[14]=e[14]+t,r[15]=e[15]+t,r},addScalarMat4:function(e,t,r){return k.addMat4Scalar(t,e,r)},subMat4:function(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r[9]=e[9]-t[9],r[10]=e[10]-t[10],r[11]=e[11]-t[11],r[12]=e[12]-t[12],r[13]=e[13]-t[13],r[14]=e[14]-t[14],r[15]=e[15]-t[15],r},subMat4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]-t,r[3]=e[3]-t,r[4]=e[4]-t,r[5]=e[5]-t,r[6]=e[6]-t,r[7]=e[7]-t,r[8]=e[8]-t,r[9]=e[9]-t,r[10]=e[10]-t,r[11]=e[11]-t,r[12]=e[12]-t,r[13]=e[13]-t,r[14]=e[14]-t,r[15]=e[15]-t,r},subScalarMat4:function(e,t,r){return r||(r=t),r[0]=e-t[0],r[1]=e-t[1],r[2]=e-t[2],r[3]=e-t[3],r[4]=e-t[4],r[5]=e-t[5],r[6]=e-t[6],r[7]=e-t[7],r[8]=e-t[8],r[9]=e-t[9],r[10]=e-t[10],r[11]=e-t[11],r[12]=e-t[12],r[13]=e-t[13],r[14]=e-t[14],r[15]=e-t[15],r},mulMat4:function(e,t,r){r||(r=e);var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],d=e[10],p=e[11],v=e[12],m=e[13],y=e[14],g=e[15],x=t[0],w=t[1],b=t[2],M=t[3],I=t[4],T=t[5],A=t[6],S=t[7],O=t[8],L=t[9],P=t[10],E=t[11],j=t[12],G=t[13],_=t[14],k=t[15];return r[0]=x*n+w*s+b*h+M*v,r[1]=x*i+w*u+b*f+M*m,r[2]=x*o+w*c+b*d+M*y,r[3]=x*a+w*l+b*p+M*g,r[4]=I*n+T*s+A*h+S*v,r[5]=I*i+T*u+A*f+S*m,r[6]=I*o+T*c+A*d+S*y,r[7]=I*a+T*l+A*p+S*g,r[8]=O*n+L*s+P*h+E*v,r[9]=O*i+L*u+P*f+E*m,r[10]=O*o+L*c+P*d+E*y,r[11]=O*a+L*l+P*p+E*g,r[12]=j*n+G*s+_*h+k*v,r[13]=j*i+G*u+_*f+k*m,r[14]=j*o+G*c+_*d+k*y,r[15]=j*a+G*l+_*p+k*g,r},mulMat3:function(e,t,r){r||(r=new E(9));var n=e[0],i=e[3],o=e[6],a=e[1],s=e[4],u=e[7],c=e[2],l=e[5],h=e[8],f=t[0],d=t[3],p=t[6],v=t[1],m=t[4],y=t[7],g=t[2],x=t[5],w=t[8];return r[0]=n*f+i*v+o*g,r[3]=n*d+i*m+o*x,r[6]=n*p+i*y+o*w,r[1]=a*f+s*v+u*g,r[4]=a*d+s*m+u*x,r[7]=a*p+s*y+u*w,r[2]=c*f+l*v+h*g,r[5]=c*d+l*m+h*x,r[8]=c*p+l*y+h*w,r},mulMat4Scalar:function(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r[8]=e[8]*t,r[9]=e[9]*t,r[10]=e[10]*t,r[11]=e[11]*t,r[12]=e[12]*t,r[13]=e[13]*t,r[14]=e[14]*t,r[15]=e[15]*t,r},mulMat4v4:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.vec4(),n=t[0],i=t[1],o=t[2],a=t[3];return r[0]=e[0]*n+e[4]*i+e[8]*o+e[12]*a,r[1]=e[1]*n+e[5]*i+e[9]*o+e[13]*a,r[2]=e[2]*n+e[6]*i+e[10]*o+e[14]*a,r[3]=e[3]*n+e[7]*i+e[11]*o+e[15]*a,r},transposeMat4:function(e,t){var r=e[4],n=e[14],i=e[8],o=e[13],a=e[12],s=e[9];if(!t||e===t){var u=e[1],c=e[2],l=e[3],h=e[6],f=e[7],d=e[11];return e[1]=r,e[2]=i,e[3]=a,e[4]=u,e[6]=s,e[7]=o,e[8]=c,e[9]=h,e[11]=n,e[12]=l,e[13]=f,e[14]=d,e}return t[0]=e[0],t[1]=r,t[2]=i,t[3]=a,t[4]=e[1],t[5]=e[5],t[6]=s,t[7]=o,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=n,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},transposeMat3:function(e,t){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},determinantMat4:function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11],d=e[12],p=e[13],v=e[14],m=e[15];return d*l*s*i-c*p*s*i-d*a*h*i+o*p*h*i+c*a*v*i-o*l*v*i-d*l*n*u+c*p*n*u+d*r*h*u-t*p*h*u-c*r*v*u+t*l*v*u+d*a*n*f-o*p*n*f-d*r*s*f+t*p*s*f+o*r*v*f-t*a*v*f-c*a*n*m+o*l*n*m+c*r*s*m-t*l*s*m-o*r*h*m+t*a*h*m},inverseMat4:function(e,t){t||(t=e);var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],f=e[10],d=e[11],p=e[12],v=e[13],m=e[14],y=e[15],g=r*s-n*a,x=r*u-i*a,w=r*c-o*a,b=n*u-i*s,M=n*c-o*s,I=i*c-o*u,T=l*v-h*p,A=l*m-f*p,S=l*y-d*p,O=h*m-f*v,L=h*y-d*v,P=f*y-d*m,E=1/(g*P-x*L+w*O+b*S-M*A+I*T);return t[0]=(s*P-u*L+c*O)*E,t[1]=(-n*P+i*L-o*O)*E,t[2]=(v*I-m*M+y*b)*E,t[3]=(-h*I+f*M-d*b)*E,t[4]=(-a*P+u*S-c*A)*E,t[5]=(r*P-i*S+o*A)*E,t[6]=(-p*I+m*w-y*x)*E,t[7]=(l*I-f*w+d*x)*E,t[8]=(a*L-s*S+c*T)*E,t[9]=(-r*L+n*S-o*T)*E,t[10]=(p*M-v*w+y*g)*E,t[11]=(-l*M+h*w-d*g)*E,t[12]=(-a*O+s*A-u*T)*E,t[13]=(r*O-n*A+i*T)*E,t[14]=(-p*b+v*x-m*g)*E,t[15]=(l*b-h*x+f*g)*E,t},traceMat4:function(e){return e[0]+e[5]+e[10]+e[15]},translationMat4v:function(e,t){var r=t||k.identityMat4();return r[12]=e[0],r[13]=e[1],r[14]=e[2],r},translationMat3v:function(e,t){var r=t||k.identityMat3();return r[6]=e[0],r[7]=e[1],r},translationMat4c:(s=new E(3),function(e,t,r,n){return s[0]=e,s[1]=t,s[2]=r,k.translationMat4v(s,n)}),translationMat4s:function(e,t){return k.translationMat4c(e,e,e,t)},translateMat4v:function(e,t){return k.translateMat4c(e[0],e[1],e[2],t)},OLDtranslateMat4c:function(e,t,r,n){var i=n[12];n[0]+=i*e,n[4]+=i*t,n[8]+=i*r;var o=n[13];n[1]+=o*e,n[5]+=o*t,n[9]+=o*r;var a=n[14];n[2]+=a*e,n[6]+=a*t,n[10]+=a*r;var s=n[15];return n[3]+=s*e,n[7]+=s*t,n[11]+=s*r,n},translateMat4c:function(e,t,r,n){var i=n[3];n[0]+=i*e,n[1]+=i*t,n[2]+=i*r;var o=n[7];n[4]+=o*e,n[5]+=o*t,n[6]+=o*r;var a=n[11];n[8]+=a*e,n[9]+=a*t,n[10]+=a*r;var s=n[15];return n[12]+=s*e,n[13]+=s*t,n[14]+=s*r,n},rotationMat4v:function(e,t,r){var n,i,o,a,s,u,c=k.normalizeVec4([t[0],t[1],t[2],0],[]),l=Math.sin(e),h=Math.cos(e),f=1-h,d=c[0],p=c[1],v=c[2];return n=d*p,i=p*v,o=v*d,a=d*l,s=p*l,u=v*l,(r=r||k.mat4())[0]=f*d*d+h,r[1]=f*n+u,r[2]=f*o-s,r[3]=0,r[4]=f*n-u,r[5]=f*p*p+h,r[6]=f*i+a,r[7]=0,r[8]=f*o+s,r[9]=f*i-a,r[10]=f*v*v+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotationMat4c:function(e,t,r,n,i){return k.rotationMat4v(e,[t,r,n],i)},scalingMat4v:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.identityMat4();return t[0]=e[0],t[5]=e[1],t[10]=e[2],t},scalingMat3v:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.identityMat3();return t[0]=e[0],t[4]=e[1],t},scalingMat4c:function(){var e=new E(3);return function(t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,k.scalingMat4v(e,i)}}(),scaleMat4c:function(e,t,r,n){return n[0]*=e,n[4]*=t,n[8]*=r,n[1]*=e,n[5]*=t,n[9]*=r,n[2]*=e,n[6]*=t,n[10]*=r,n[3]*=e,n[7]*=t,n[11]*=r,n},scaleMat4v:function(e,t){var r=e[0],n=e[1],i=e[2];return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,t},scalingMat4s:function(e){return k.scalingMat4c(e,e,e)},rotationTranslationMat4:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.mat4(),n=e[0],i=e[1],o=e[2],a=e[3],s=n+n,u=i+i,c=o+o,l=n*s,h=n*u,f=n*c,d=i*u,p=i*c,v=o*c,m=a*s,y=a*u,g=a*c;return r[0]=1-(d+v),r[1]=h+g,r[2]=f-y,r[3]=0,r[4]=h-g,r[5]=1-(l+v),r[6]=p+m,r[7]=0,r[8]=f+y,r[9]=p-m,r[10]=1-(l+d),r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},mat4ToEuler:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.vec4(),n=k.clamp,i=e[0],o=e[4],a=e[8],s=e[1],u=e[5],c=e[9],l=e[2],h=e[6],f=e[10];return"XYZ"===t?(r[1]=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(r[0]=Math.atan2(-c,f),r[2]=Math.atan2(-o,i)):(r[0]=Math.atan2(h,u),r[2]=0)):"YXZ"===t?(r[0]=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(r[1]=Math.atan2(a,f),r[2]=Math.atan2(s,u)):(r[1]=Math.atan2(-l,i),r[2]=0)):"ZXY"===t?(r[0]=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(r[1]=Math.atan2(-l,f),r[2]=Math.atan2(-o,u)):(r[1]=0,r[2]=Math.atan2(s,i))):"ZYX"===t?(r[1]=Math.asin(-n(l,-1,1)),Math.abs(l)<.99999?(r[0]=Math.atan2(h,f),r[2]=Math.atan2(s,i)):(r[0]=0,r[2]=Math.atan2(-o,u))):"YZX"===t?(r[2]=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(r[0]=Math.atan2(-c,u),r[1]=Math.atan2(-l,i)):(r[0]=0,r[1]=Math.atan2(a,f))):"XZY"===t&&(r[2]=Math.asin(-n(o,-1,1)),Math.abs(o)<.99999?(r[0]=Math.atan2(h,u),r[1]=Math.atan2(a,i)):(r[0]=Math.atan2(-c,f),r[1]=0)),r},composeMat4:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.mat4();return k.quaternionToRotationMat4(t,n),k.scaleMat4v(r,n),k.translateMat4v(e,n),n},decomposeMat4:function(){var e=new E(3),t=new E(16);return function(r,n,i,o){e[0]=r[0],e[1]=r[1],e[2]=r[2];var a=k.lenVec3(e);e[0]=r[4],e[1]=r[5],e[2]=r[6];var s=k.lenVec3(e);e[8]=r[8],e[9]=r[9],e[10]=r[10];var u=k.lenVec3(e);k.determinantMat4(r)<0&&(a=-a),n[0]=r[12],n[1]=r[13],n[2]=r[14],t.set(r);var c=1/a,l=1/s,h=1/u;return t[0]*=c,t[1]*=c,t[2]*=c,t[4]*=l,t[5]*=l,t[6]*=l,t[8]*=h,t[9]*=h,t[10]*=h,k.mat4ToQuaternion(t,i),o[0]=a,o[1]=s,o[2]=u,this}}(),lookAtMat4v:function(e,t,r,n){n||(n=k.mat4());var i,o,a,s,u,c,l,h,f,d,p=e[0],v=e[1],m=e[2],y=r[0],g=r[1],x=r[2],w=t[0],b=t[1],M=t[2];return p===w&&v===b&&m===M?k.identityMat4():(i=p-w,o=v-b,a=m-M,s=g*(a*=d=1/Math.sqrt(i*i+o*o+a*a))-x*(o*=d),u=x*(i*=d)-y*a,c=y*o-g*i,(d=Math.sqrt(s*s+u*u+c*c))?(s*=d=1/d,u*=d,c*=d):(s=0,u=0,c=0),l=o*c-a*u,h=a*s-i*c,f=i*u-o*s,(d=Math.sqrt(l*l+h*h+f*f))?(l*=d=1/d,h*=d,f*=d):(l=0,h=0,f=0),n[0]=s,n[1]=l,n[2]=i,n[3]=0,n[4]=u,n[5]=h,n[6]=o,n[7]=0,n[8]=c,n[9]=f,n[10]=a,n[11]=0,n[12]=-(s*p+u*v+c*m),n[13]=-(l*p+h*v+f*m),n[14]=-(i*p+o*v+a*m),n[15]=1,n)},lookAtMat4c:function(e,t,r,n,i,o,a,s,u){return k.lookAtMat4v([e,t,r],[n,i,o],[a,s,u],[])},orthoMat4c:function(e,t,r,n,i,o,a){a||(a=k.mat4());var s=t-e,u=n-r,c=o-i;return a[0]=2/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/u,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/c,a[11]=0,a[12]=-(e+t)/s,a[13]=-(n+r)/u,a[14]=-(o+i)/c,a[15]=1,a},frustumMat4v:function(e,t,r){r||(r=k.mat4());var n=[e[0],e[1],e[2],0],i=[t[0],t[1],t[2],0];k.addVec4(i,n,j),k.subVec4(i,n,G);var o=2*n[2],a=G[0],s=G[1],u=G[2];return r[0]=o/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o/s,r[6]=0,r[7]=0,r[8]=j[0]/a,r[9]=j[1]/s,r[10]=-j[2]/u,r[11]=-1,r[12]=0,r[13]=0,r[14]=-o*i[2]/u,r[15]=0,r},frustumMat4:function(e,t,r,n,i,o,a){a||(a=k.mat4());var s=t-e,u=n-r,c=o-i;return a[0]=2*i/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*i/u,a[6]=0,a[7]=0,a[8]=(t+e)/s,a[9]=(n+r)/u,a[10]=-(o+i)/c,a[11]=-1,a[12]=0,a[13]=0,a[14]=-o*i*2/c,a[15]=0,a},perspectiveMat4:function(e,t,r,n,i){var o=[],a=[];return o[2]=r,a[2]=n,a[1]=o[2]*Math.tan(e/2),o[1]=-a[1],a[0]=a[1]*t,o[0]=-a[0],k.frustumMat4v(o,a,i)},transformPoint3:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.vec3(),n=t[0],i=t[1],o=t[2];return r[0]=e[0]*n+e[4]*i+e[8]*o+e[12],r[1]=e[1]*n+e[5]*i+e[9]*o+e[13],r[2]=e[2]*n+e[6]*i+e[10]*o+e[14],r},transformPoint4:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.vec4();return r[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],r[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],r[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],r[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],r},transformPoints3:function(e,t,r){for(var n,i,o,a,s,u=r||[],c=t.length,l=e[0],h=e[1],f=e[2],d=e[3],p=e[4],v=e[5],m=e[6],y=e[7],g=e[8],x=e[9],w=e[10],b=e[11],M=e[12],I=e[13],T=e[14],A=e[15],S=0;S<c;++S)n=(a=t[S])[0],i=a[1],o=a[2],(s=u[S]||(u[S]=[0,0,0]))[0]=l*n+p*i+g*o+M,s[1]=h*n+v*i+x*o+I,s[2]=f*n+m*i+w*o+T,s[3]=d*n+y*i+b*o+A;return u.length=c,u},transformPositions3:function(e,t){var r,n,i,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,s=t.length,u=e[0],c=e[1],l=e[2],h=e[3],f=e[4],d=e[5],p=e[6],v=e[7],m=e[8],y=e[9],g=e[10],x=e[11],w=e[12],b=e[13],M=e[14],I=e[15];for(r=0;r<s;r+=3)n=t[r+0],i=t[r+1],o=t[r+2],a[r+0]=u*n+f*i+m*o+w,a[r+1]=c*n+d*i+y*o+b,a[r+2]=l*n+p*i+g*o+M,a[r+3]=h*n+v*i+x*o+I;return a},transformPositions4:function(e,t){var r,n,i,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,s=t.length,u=e[0],c=e[1],l=e[2],h=e[3],f=e[4],d=e[5],p=e[6],v=e[7],m=e[8],y=e[9],g=e[10],x=e[11],w=e[12],b=e[13],M=e[14],I=e[15];for(r=0;r<s;r+=4)n=t[r+0],i=t[r+1],o=t[r+2],a[r+0]=u*n+f*i+m*o+w,a[r+1]=c*n+d*i+y*o+b,a[r+2]=l*n+p*i+g*o+M,a[r+3]=h*n+v*i+x*o+I;return a},transformVec3:function(e,t,r){var n=t[0],i=t[1],o=t[2];return(r=r||this.vec3())[0]=e[0]*n+e[4]*i+e[8]*o,r[1]=e[1]*n+e[5]*i+e[9]*o,r[2]=e[2]*n+e[6]*i+e[10]*o,r},transformVec4:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3];return(r=r||k.vec4())[0]=e[0]*n+e[4]*i+e[8]*o+e[12]*a,r[1]=e[1]*n+e[5]*i+e[9]*o+e[13]*a,r[2]=e[2]*n+e[6]*i+e[10]*o+e[14]*a,r[3]=e[3]*n+e[7]*i+e[11]*o+e[15]*a,r},rotateVec3X:function(e,t,r,n){var i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n},rotateVec3Y:function(e,t,r,n){var i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n},rotateVec3Z:function(e,t,r,n){var i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n},projectVec4:function(e,t){var r=1/e[3];return(t=t||k.vec2())[0]=v[0]*r,t[1]=v[1]*r,t},unprojectVec3:(i=new E(16),o=new E(16),a=new E(16),function(e,t,r,n){return this.transformVec3(this.mulMat4(this.inverseMat4(t,i),this.inverseMat4(r,o),a),e,n)}),lerpVec3:function(e,t,r,n,i,o){var a=o||k.vec3(),s=(e-t)/(r-t);return a[0]=n[0]+s*(i[0]-n[0]),a[1]=n[1]+s*(i[1]-n[1]),a[2]=n[2]+s*(i[2]-n[2]),a},flatten:function(e){var t,r,n,i,o,a=[];for(t=0,r=e.length;t<r;t++)for(n=0,i=(o=e[t]).length;n<i;n++)a.push(o[n]);return a},identityQuaternion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.vec4();return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},eulerToQuaternion:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.vec4(),n=e[0]*k.DEGTORAD/2,i=e[1]*k.DEGTORAD/2,o=e[2]*k.DEGTORAD/2,a=Math.cos(n),s=Math.cos(i),u=Math.cos(o),c=Math.sin(n),l=Math.sin(i),h=Math.sin(o);return"XYZ"===t?(r[0]=c*s*u+a*l*h,r[1]=a*l*u-c*s*h,r[2]=a*s*h+c*l*u,r[3]=a*s*u-c*l*h):"YXZ"===t?(r[0]=c*s*u+a*l*h,r[1]=a*l*u-c*s*h,r[2]=a*s*h-c*l*u,r[3]=a*s*u+c*l*h):"ZXY"===t?(r[0]=c*s*u-a*l*h,r[1]=a*l*u+c*s*h,r[2]=a*s*h+c*l*u,r[3]=a*s*u-c*l*h):"ZYX"===t?(r[0]=c*s*u-a*l*h,r[1]=a*l*u+c*s*h,r[2]=a*s*h-c*l*u,r[3]=a*s*u+c*l*h):"YZX"===t?(r[0]=c*s*u+a*l*h,r[1]=a*l*u+c*s*h,r[2]=a*s*h-c*l*u,r[3]=a*s*u-c*l*h):"XZY"===t&&(r[0]=c*s*u-a*l*h,r[1]=a*l*u-c*s*h,r[2]=a*s*h+c*l*u,r[3]=a*s*u+c*l*h),r},mat4ToQuaternion:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.vec4(),n=e[0],i=e[4],o=e[8],a=e[1],s=e[5],u=e[9],c=e[2],l=e[6],h=e[10],f=n+s+h;return f>0?(t=.5/Math.sqrt(f+1),r[3]=.25/t,r[0]=(l-u)*t,r[1]=(o-c)*t,r[2]=(a-i)*t):n>s&&n>h?(t=2*Math.sqrt(1+n-s-h),r[3]=(l-u)/t,r[0]=.25*t,r[1]=(i+a)/t,r[2]=(o+c)/t):s>h?(t=2*Math.sqrt(1+s-n-h),r[3]=(o-c)/t,r[0]=(i+a)/t,r[1]=.25*t,r[2]=(u+l)/t):(t=2*Math.sqrt(1+h-n-s),r[3]=(a-i)/t,r[0]=(o+c)/t,r[1]=(u+l)/t,r[2]=.25*t),r},vec3PairToQuaternion:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.vec4(),n=Math.sqrt(k.dotVec3(e,e)*k.dotVec3(t,t)),i=n+k.dotVec3(e,t);return i<1e-8*n?(i=0,Math.abs(e[0])>Math.abs(e[2])?(r[0]=-e[1],r[1]=e[0],r[2]=0):(r[0]=0,r[1]=-e[2],r[2]=e[1])):k.cross3Vec3(e,t,r),r[3]=i,k.normalizeQuaternion(r)},angleAxisToQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.vec4(),r=e[3]/2,n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t},quaternionToEuler:function(){var e=new E(16);return function(t,r,n){return n=n||k.vec3(),k.quaternionToRotationMat4(t,e),k.mat4ToEuler(e,r,n),n}}(),mulQuaternions:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.vec4(),n=e[0],i=e[1],o=e[2],a=e[3],s=t[0],u=t[1],c=t[2],l=t[3];return r[0]=a*s+n*l+i*c-o*u,r[1]=a*u+i*l+o*s-n*c,r[2]=a*c+o*l+n*u-i*s,r[3]=a*l-n*s-i*u-o*c,r},vec3ApplyQuaternion:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.vec3(),n=t[0],i=t[1],o=t[2],a=e[0],s=e[1],u=e[2],c=e[3],l=c*n+s*o-u*i,h=c*i+u*n-a*o,f=c*o+a*i-s*n,d=-a*n-s*i-u*o;return r[0]=l*c+d*-a+h*-u-f*-s,r[1]=h*c+d*-s+f*-a-l*-u,r[2]=f*c+d*-u+l*-s-h*-a,r},quaternionToMat4:function(e,t){t=k.identityMat4(t);var r=e[0],n=e[1],i=e[2],o=e[3],a=2*r,s=2*n,u=2*i,c=a*o,l=s*o,h=u*o,f=a*r,d=s*r,p=u*r,v=s*n,m=u*n,y=u*i;return t[0]=1-(v+y),t[1]=d+h,t[2]=p-l,t[4]=d-h,t[5]=1-(f+y),t[6]=m+c,t[8]=p+l,t[9]=m-c,t[10]=1-(f+v),t},quaternionToRotationMat4:function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,u=i+i,c=r*a,l=r*s,h=r*u,f=n*s,d=n*u,p=i*u,v=o*a,m=o*s,y=o*u;return t[0]=1-(f+p),t[4]=l-y,t[8]=h+m,t[1]=l+y,t[5]=1-(c+p),t[9]=d-v,t[2]=h-m,t[6]=d+v,t[10]=1-(c+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},normalizeQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=k.lenVec4([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r,t[3]=e[3]/r,t},conjugateQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},inverseQuaternion:function(e,t){return k.normalizeQuaternion(k.conjugateQuaternion(e,t))},quaternionToAngleAxis:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.vec4(),r=(e=k.normalizeQuaternion(e,_))[3],n=2*Math.acos(r),i=Math.sqrt(1-r*r);return i<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i),t[3]=n,t},AABB3:function(e){return new E(e||6)},AABB2:function(e){return new E(e||4)},OBB3:function(e){return new E(e||32)},OBB2:function(e){return new E(e||16)},Sphere3:function(e,t,r,n){return new E([e,t,r,n])},transformOBB3:function(e,t){var r,n,i,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,s=t.length,u=e[0],c=e[1],l=e[2],h=e[3],f=e[4],d=e[5],p=e[6],v=e[7],m=e[8],y=e[9],g=e[10],x=e[11],w=e[12],b=e[13],M=e[14],I=e[15];for(r=0;r<s;r+=4)n=t[r+0],i=t[r+1],o=t[r+2],a[r+0]=u*n+f*i+m*o+w,a[r+1]=c*n+d*i+y*o+b,a[r+2]=l*n+p*i+g*o+M,a[r+3]=h*n+v*i+x*o+I;return a},containsAABB3:function(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]},getAABB3Diag:function(){var e=new E(3),t=new E(3),r=new E(3);return function(n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],t[0]=n[3],t[1]=n[4],t[2]=n[5],k.subVec3(t,e,r),Math.abs(k.lenVec3(r))}}(),getAABB3DiagPoint:function(){var e=new E(3),t=new E(3),r=new E(3);return function(n,i){e[0]=n[0],e[1]=n[1],e[2]=n[2],t[0]=n[3],t[1]=n[4],t[2]=n[5];var o=k.subVec3(t,e,r),a=i[0]-n[0],s=n[3]-i[0],u=i[1]-n[1],c=n[4]-i[1],l=i[2]-n[2],h=n[5]-i[2];return o[0]+=a>s?a:s,o[1]+=u>c?u:c,o[2]+=l>h?l:h,Math.abs(k.lenVec3(o))}}(),getAABB3Center:function(e,t){var r=t||k.vec3();return r[0]=(e[0]+e[3])/2,r[1]=(e[1]+e[4])/2,r[2]=(e[2]+e[5])/2,r},getAABB2Center:function(e,t){var r=t||k.vec2();return r[0]=(e[2]+e[0])/2,r[1]=(e[3]+e[1])/2,r},collapseAABB3:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.AABB3();return e[0]=k.MAX_DOUBLE,e[1]=k.MAX_DOUBLE,e[2]=k.MAX_DOUBLE,e[3]=-k.MAX_DOUBLE,e[4]=-k.MAX_DOUBLE,e[5]=-k.MAX_DOUBLE,e},AABB3ToOBB3:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.OBB3();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t},positions3ToAABB3:(t=new E(3),function(e,r,n){r=r||k.AABB3();for(var i,o,a,s=k.MAX_DOUBLE,u=k.MAX_DOUBLE,c=k.MAX_DOUBLE,l=-k.MAX_DOUBLE,h=-k.MAX_DOUBLE,f=-k.MAX_DOUBLE,d=0,p=e.length;d<p;d+=3)n?(t[0]=e[d+0],t[1]=e[d+1],t[2]=e[d+2],k.decompressPosition(t,n,t),i=t[0],o=t[1],a=t[2]):(i=e[d+0],o=e[d+1],a=e[d+2]),i<s&&(s=i),o<u&&(u=o),a<c&&(c=a),i>l&&(l=i),o>h&&(h=o),a>f&&(f=a);return r[0]=s,r[1]=u,r[2]=c,r[3]=l,r[4]=h,r[5]=f,r}),OBB3ToAABB3:function(e){for(var t,r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.AABB3(),o=k.MAX_DOUBLE,a=k.MAX_DOUBLE,s=k.MAX_DOUBLE,u=-k.MAX_DOUBLE,c=-k.MAX_DOUBLE,l=-k.MAX_DOUBLE,h=0,f=e.length;h<f;h+=4)(t=e[h+0])<o&&(o=t),(r=e[h+1])<a&&(a=r),(n=e[h+2])<s&&(s=n),t>u&&(u=t),r>c&&(c=r),n>l&&(l=n);return i[0]=o,i[1]=a,i[2]=s,i[3]=u,i[4]=c,i[5]=l,i},points3ToAABB3:function(e){for(var t,r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.AABB3(),o=k.MAX_DOUBLE,a=k.MAX_DOUBLE,s=k.MAX_DOUBLE,u=-k.MAX_DOUBLE,c=-k.MAX_DOUBLE,l=-k.MAX_DOUBLE,h=0,f=e.length;h<f;h++)(t=e[h][0])<o&&(o=t),(r=e[h][1])<a&&(a=r),(n=e[h][2])<s&&(s=n),t>u&&(u=t),r>c&&(c=r),n>l&&(l=n);return i[0]=o,i[1]=a,i[2]=s,i[3]=u,i[4]=c,i[5]=l,i},points3ToSphere3:function(){var e=new E(3);return function(t,r){r=r||k.vec4();var n,i=0,o=0,a=0,s=t.length;for(n=0;n<s;n++)i+=t[n][0],o+=t[n][1],a+=t[n][2];r[0]=i/s,r[1]=o/s,r[2]=a/s;var u,c=0;for(n=0;n<s;n++)(u=Math.abs(k.lenVec3(k.subVec3(t[n],r,e))))>c&&(c=u);return r[3]=c,r}}(),positions3ToSphere3:function(){var e=new E(3),t=new E(3);return function(r,n){n=n||k.vec4();var i,o=0,a=0,s=0,u=r.length,c=0;for(i=0;i<u;i+=3)o+=r[i],a+=r[i+1],s+=r[i+2];var l,h=u/3;for(n[0]=o/h,n[1]=a/h,n[2]=s/h,i=0;i<u;i+=3)e[0]=r[i],e[1]=r[i+1],e[2]=r[i+2],(l=Math.abs(k.lenVec3(k.subVec3(e,n,t))))>c&&(c=l);return n[3]=c,n}}(),OBB3ToSphere3:function(){var e=new E(3),t=new E(3);return function(r,n){n=n||k.vec4();var i,o=0,a=0,s=0,u=r.length,c=u/4;for(i=0;i<u;i+=4)o+=r[i+0],a+=r[i+1],s+=r[i+2];n[0]=o/c,n[1]=a/c,n[2]=s/c;var l,h=0;for(i=0;i<u;i+=4)e[0]=r[i+0],e[1]=r[i+1],e[2]=r[i+2],(l=Math.abs(k.lenVec3(k.subVec3(e,n,t))))>h&&(h=l);return n[3]=h,n}}(),getSphere3Center:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.vec3();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},expandAABB3:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e},expandAABB3Point3:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e},triangleNormal:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.vec3(),i=t[0]-e[0],o=t[1]-e[1],a=t[2]-e[2],s=r[0]-e[0],u=r[1]-e[1],c=r[2]-e[2],l=o*c-a*u,h=a*s-i*c,f=i*u-o*s,d=Math.sqrt(l*l+h*h+f*f);return 0===d?(n[0]=0,n[1]=0,n[2]=0):(n[0]=l/d,n[1]=h/d,n[2]=f/d),n}};function D(e,t,r,n){var i=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),o=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var a=(1-Math.abs(o))*(i>=0?1:-1),s=(1-Math.abs(i))*(o>=0?1:-1);i=a,o=s}return new Int8Array([Math[r](127.5*i+(i<0?-1:0)),Math[n](127.5*o+(o<0?-1:0))])}function F(e){var t=e[0],r=e[1];t/=t<0?127:128,r/=r<0?127:128;var n=1-Math.abs(t)-Math.abs(r);n<0&&(t=(1-Math.abs(r))*(t>=0?1:-1),r=(1-Math.abs(t))*(r>=0?1:-1));var i=Math.sqrt(t*t+r*r+n*n);return[t/i,r/i,n/i]}function N(e,t,r){return e[t]*r[0]+e[t+1]*r[1]+e[t+2]*r[2]}var V,C,B,U,z,X,R,K,q,Z,Y,Q,W,J,H,$,ee,te={quantizePositions:function(e,t,r,n){for(var i=r[0],o=r[1],a=r[2],s=65535,u=s/(r[3]-i),c=s/(r[4]-o),l=s/(r[5]-a),h=function(e){return e>=0?e:0},f=0;f<t;f+=3)n[f+0]=Math.max(0,Math.min(65535,Math.floor(h(e[f+0]-i)*u))),n[f+1]=Math.max(0,Math.min(65535,Math.floor(h(e[f+1]-o)*c))),n[f+2]=Math.max(0,Math.min(65535,Math.floor(h(e[f+2]-a)*l)))},compressPosition:function(e,t,r){var n=new Float32Array([t[3]!==t[0]?65535/(t[3]-t[0]):0,t[4]!==t[1]?65535/(t[4]-t[1]):0,t[5]!==t[2]?65535/(t[5]-t[2]):0]);r[0]=Math.max(0,Math.min(65535,Math.floor((e[0]-t[0])*n[0]))),r[1]=Math.max(0,Math.min(65535,Math.floor((e[1]-t[1])*n[1]))),r[2]=Math.max(0,Math.min(65535,Math.floor((e[2]-t[2])*n[2])))},createPositionsDecodeMatrix:(l=k.mat4(),h=k.mat4(),function(e,t){t=t||k.mat4();var r=e[0],n=e[1],i=e[2],o=e[3]-r,a=e[4]-n,s=e[5]-i,u=65535;return k.identityMat4(l),k.translationMat4v(e,l),k.identityMat4(h),k.scalingMat4v([o/u,a/u,s/u],h),k.mulMat4(l,h,t),t}),transformAndOctEncodeNormals:function(e,t,r,n,i){var o,a,s,u,c,l=k.vec3(),h=k.vec3();for(c=0;c<r;c+=3)l[0]=t[c],l[1]=t[c+1],l[2]=t[c+2],k.transformVec3(e,l,h),k.normalizeVec3(h,h),a=o=D(h,0,"floor","floor"),s=u=N(h,0,F(o)),(s=N(h,0,F(o=D(h,0,"ceil","floor"))))>u&&(a=o,u=s),(s=N(h,0,F(o=D(h,0,"floor","ceil"))))>u&&(a=o,u=s),(s=N(h,0,F(o=D(h,0,"ceil","ceil"))))>u&&(a=o,u=s),n[i+c+0]=a[0],n[i+c+1]=a[1],n[i+c+2]=0;return i+r},octEncodeNormals:function(e,t,r,n){for(var i,o,a,s,u=0;u<t;u+=3)o=i=D(e,u,"floor","floor"),a=s=N(e,u,F(i)),(a=N(e,u,F(i=D(e,u,"ceil","floor"))))>s&&(o=i,s=a),(a=N(e,u,F(i=D(e,u,"floor","ceil"))))>s&&(o=i,s=a),(a=N(e,u,F(i=D(e,u,"ceil","ceil"))))>s&&(o=i,s=a),r[n+u+0]=o[0],r[n+u+1]=o[1],r[n+u+2]=0;return n+t}},re=(V=[],C=[],B=[],U=[],z=[],X=0,R=new Uint16Array(3),K=new Uint16Array(3),q=new Uint16Array(3),Z=k.vec3(),Y=k.vec3(),Q=k.vec3(),W=k.vec3(),J=k.vec3(),H=k.vec3(),$=k.vec3(),ee=k.vec3(),function(e,t,r,n){!function(e,t){var r,n,i,o,a,s,u={},c=Math.pow(10,4),l=0;for(a=0,s=e.length;a<s;a+=3)r=e[a],n=e[a+1],i=e[a+2],void 0===u[o=Math.round(r*c)+"_"+Math.round(n*c)+"_"+Math.round(i*c)]&&(u[o]=l/3,V[l++]=r,V[l++]=n,V[l++]=i),C[a/3]=u[o];for(a=0,s=t.length;a<s;a++)U[a]=C[t[a]],B[U[a]]=t[a]}(e,t),function(e,t){X=0;for(var r=0,n=e;r<n;r+=3){var i=3*U[r],o=3*U[r+1],a=3*U[r+2];t?(R[0]=V[i],R[1]=V[i+1],R[2]=V[i+2],K[0]=V[o],K[1]=V[o+1],K[2]=V[o+2],q[0]=V[a],q[1]=V[a+1],q[2]=V[a+2],k.decompressPosition(R,t,Z),k.decompressPosition(K,t,Y),k.decompressPosition(q,t,Q)):(Z[0]=V[i],Z[1]=V[i+1],Z[2]=V[i+2],Y[0]=V[o],Y[1]=V[o+1],Y[2]=V[o+2],Q[0]=V[a],Q[1]=V[a+1],Q[2]=V[a+2]),k.subVec3(Q,Y,W),k.subVec3(Z,Y,J),k.cross3Vec3(W,J,H),k.normalizeVec3(H,$);var s=z[X]||(z[X]={normal:k.vec3()});s.normal[0]=$[0],s.normal[1]=$[1],s.normal[2]=$[2],X++}}(t.length,r);for(var i,o,a,s,u,c,l,h,f,d,p,v=[],m=Math.cos(k.DEGTORAD*n),y={},g=!1,x=0,w=t.length;x<w;x+=3)for(var b=x/3,M=0;M<3;M++)i=U[x+M],o=U[x+(M+1)%3],void 0===y[u=(a=Math.min(i,o))+","+(s=Math.max(i,o))]?y[u]={index1:a,index2:s,face1:b,face2:void 0}:y[u].face2=b;for(u in y){if(void 0!==(c=y[u]).face2){l=z[c.face1].normal,h=z[c.face2].normal,ee[0]=-h[0],ee[1]=-h[1],ee[2]=-h[2],f=Math.abs(k.dotVec3(l,h));var I=Math.abs(k.dotVec3(l,ee));if(f>m&&I>m)continue}d=B[c.index1],p=B[c.index2],(!g&&d>65535||p>65535)&&(g=!0),v.push(d),v.push(p)}return g?new Uint32Array(v):new Uint16Array(v)}),ne=function(e,t,r,n){function i(e,r){for(var n,i,o=0;o<3;o++)if((n=t[3*e+o])!==(i=t[3*r+o]))return i-n;return 0}for(var o=e.slice().sort(i),a=null,s=0,u=o.length;s<u;s++)0!=s&&0==i(o[s],o[s-1])||(a=o[s]),r[o[s]]=a;for(var c=0,l=e.length;c<l;c+=3){var h=r[e[c]],f=r[e[c+1]],d=r[e[c+2]],p=h,v=f,m=d;if(h>f&&h>d?f>d?(p=h,v=f,m=d):(p=h,v=d,m=f):f>h&&f>d?h>d?(p=f,v=h,m=d):(p=f,v=d,m=h):d>h&&d>f&&(h>f?(p=d,v=h,m=f):(p=d,v=f,m=h)),n[c+0]=[p,v],n[c+1]=[v,m],p>m){var y=m;m=p,p=y}n[c+2]=[m,p]}function g(e,t){for(var r,n,i=0;i<2;i++)if(r=e[i],(n=t[i])!==r)return n-r;return 0}(n=n.slice(0,e.length)).sort(g);for(var x=0,w=0;w<n.length;w++)if(0===w||0!==g(n[w],n[w-1])){if(0!==w&&2!==x)return!1;x=1}else x++;return!(n.length>0&&2!==x)};function ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function oe(e,t,r){return t&&ie(e.prototype,t),r&&ie(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var ae=oe((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.meshId=t.meshId,this.meshIndex=t.meshIndex,this.matrix=t.matrix,this.geometry=t.geometry,this.color=t.color||new Float32Array([1,1,1]),this.metallic=null!==t.metallic&&void 0!==t.metallic?t.metallic:0,this.roughness=null!==t.roughness&&void 0!==t.roughness?t.roughness:1,this.opacity=void 0!==t.opacity&&null!==t.opacity?t.opacity:1,this.textureSet=t.textureSet,this.entity=null}));function se(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ue=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.geometryId=t.geometryId,this.primitiveType=t.primitiveType,this.geometryIndex=t.geometryIndex,this.numInstances=0,this.positions=t.positions,this.positionsQuantized=new Uint16Array(t.positions.length),this.normals=t.normals,this.normalsOctEncoded=null,this.colorsCompressed=t.colorsCompressed,this.uvs=t.uvs,this.uvsCompressed=t.uvsCompressed,this.indices=t.indices,this.edgeIndices=t.edgeIndices,this.solid=!1}var t,r;return t=e,(r=[{key:"reused",get:function(){return this.numInstances>1}}])&&se(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ce(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function le(e,t,r){return t&&ce(e.prototype,t),r&&ce(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var he=le((function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.entityId=t,this.entityIndex=null,this.meshes=r,this.aabb=k.AABB3(),this.hasReusedGeometries=!1}));function fe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function de(e,t,r){return t&&fe(e.prototype,t),r&&fe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var pe=de((function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.aabb=t,this.entities=r}));function ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function me(e,t,r){return t&&ve(e.prototype,t),r&&ve(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var ye=me((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.aabb=t,this.entities=null,this.left=null,this.right=null}));function ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xe(e,t,r){return t&&ge(e.prototype,t),r&&ge(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var we=xe((function e(t,r,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.metaObjectId=t,this.propertySetIds=r,this.metaObjectType=n,this.metaObjectName=i,this.parentMetaObjectId=o}));function be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Me(e,t,r){return t&&be(e.prototype,t),r&&be(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var Ie=Me((function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.propertySetId=t,this.propertySetType=r,this.propertySetName=n,this.properties=i}));function Te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ae(e,t,r){return t&&Te(e.prototype,t),r&&Te(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var Se=Ae((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textureId=t.textureId,this.textureIndex=t.textureIndex,this.imageData=t.imageData,this.channel=null,this.width=t.width,this.height=t.height,this.src=t.src,this.compressed=!!t.compressed,this.mediaType=t.mediaType,this.minFilter=t.minFilter||T,this.magFilter=t.magFilter||T,this.wrapS=t.wrapS||d,this.wrapT=t.wrapT||d,this.wrapR=t.wrapR||d}));function Oe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Le(e,t,r){return t&&Oe(e.prototype,t),r&&Oe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var Pe=Le((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textureSetId=t.textureSetId,this.textureSetIndex=t.textureSetIndex,this.materialType=t.materialType,this.materialIndex=t.materialIndex,this.numInstances=0,this.colorTexture=t.colorTexture,this.metallicRoughnessTexture=t.metallicRoughnessTexture,this.normalsTexture=t.normalsTexture,this.emissiveTexture=t.emissiveTexture,this.occlusionTexture=t.occlusionTexture}));const Ee=require("@loaders.gl/core"),je=require("@loaders.gl/textures"),Ge=require("@loaders.gl/images");function _e(e){return _e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_e(e)}function ke(){ke=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof h?t:h,o=Object.create(i.prototype),a=new I(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function h(){}function f(){}function d(){}var p={};s(p,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(T([])));m&&m!==t&&r.call(m,i)&&(p=m);var y=d.prototype=h.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(i,o,a,s){var u=c(e[i],e,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==_e(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=d,s(y,"constructor",d),s(d,"constructor",f),f.displayName=s(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},g(x.prototype),s(x.prototype,o,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new x(u(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(y),s(y,a,"Generator"),s(y,i,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;M(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function De(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function Fe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ve=k.vec4([0,0,0,1]),Ce=k.vec4([0,0,0,1]),Be=k.mat4(),Ue=k.mat4(),ze=new Float64Array(3),Xe={0:{useSRGB:!0,qualityLevel:50,encodeUASTC:!0,mipmaps:!0},3:{useSRGB:!0,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},1:{useSRGB:!1,encodeUASTC:!0,qualityLevel:50,mipmaps:!0},2:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},4:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1}},Re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Fe(this,e),this.modelId=t.modelId||"default",this.projectId=t.projectId||"",this.revisionId=t.revisionId||"",this.author=t.author||"",this.createdAt=t.createdAt||"",this.creatingApplication=t.creatingApplication||"",this.schema=t.schema||"",this.xktVersion=f.xktVersion,this.edgeThreshold=t.edgeThreshold||10,this.minTileSize=t.minTileSize||500,this.propertySets={},this.propertySetsList=[],this.metaObjects={},this.metaObjectsList=[],this.reusedGeometriesDecodeMatrix=new Float32Array(16),this.geometries={},this.geometriesList=[],this.textures={},this.texturesList=[],this.textureSets={},this.textureSetsList=[],this.meshes={},this.meshesList=[],this.entities={},this.entitiesList=[],this.tilesList=[],this.aabb=k.AABB3(),this.finalized=!1}var t,r,n,i;return t=e,r=[{key:"createPropertySet",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.propertySetId||void 0===e.propertySetId)throw"Parameter expected: params.propertySetId";if(null===e.properties||void 0===e.properties)throw"Parameter expected: params.properties";if(this.finalized)console.error("XKTModel has been finalized, can't add more property sets");else if(!this.propertySets[e.propertySetId]){var t=e.propertySetId,r=e.propertySetType||"Default",n=e.propertySetName||e.propertySetId,i=e.properties||[],o=new Ie(t,r,n,i);return this.propertySets[t]=o,this.propertySetsList.push(o),o}}},{key:"createMetaObject",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.metaObjectId||void 0===e.metaObjectId)throw"Parameter expected: params.metaObjectId";if(this.finalized)console.error("XKTModel has been finalized, can't add more meta objects");else if(!this.metaObjects[e.metaObjectId]){var t=e.metaObjectId,r=e.propertySetIds,n=e.metaObjectType||"Default",i=e.metaObjectName||e.metaObjectId,o=e.parentMetaObjectId,a=new we(t,r,n,i,o);return this.metaObjects[t]=a,this.metaObjectsList.push(a),o||this._rootMetaObject||(this._rootMetaObject=a),a}}},{key:"createTexture",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.textureId||void 0===e.textureId)throw"Parameter expected: params.textureId";if(!e.imageData&&!e.src)throw"Parameter expected: params.imageData or params.src";if(this.finalized)console.error("XKTModel has been finalized, can't add more textures");else{if(!this.textures[e.textureId]){if(e.src){var t=e.src.split(".").pop();if("jpg"!==t&&"jpeg"!==t&&"png"!==t)return void console.error("XKTModel does not support image files with extension '".concat(t,"' - won't create texture '").concat(e.textureId))}var r=e.textureId,n=new Se({textureId:r,imageData:e.imageData,mediaType:e.mediaType,minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,width:e.width,height:e.height,compressed:!1!==e.compressed,src:e.src});return this.textures[r]=n,this.texturesList.push(n),n}console.error("XKTTexture already exists with this ID: "+e.textureId)}}},{key:"createTextureSet",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.textureSetId||void 0===e.textureSetId)throw"Parameter expected: params.textureSetId";if(this.finalized)console.error("XKTModel has been finalized, can't add more textureSets");else{if(!this.textureSets[e.textureSetId]){var t,r,n,i,o;if(void 0!==e.colorTextureId&&null!==e.colorTextureId){if(!(t=this.textures[e.colorTextureId]))return void console.error("Texture not found: ".concat(e.colorTextureId," - ensure that you create it first with createTexture()"));t.channel=0}if(void 0!==e.metallicRoughnessTextureId&&null!==e.metallicRoughnessTextureId){if(!(r=this.textures[e.metallicRoughnessTextureId]))return void console.error("Texture not found: ".concat(e.metallicRoughnessTextureId," - ensure that you create it first with createTexture()"));r.channel=1}if(void 0!==e.normalsTextureId&&null!==e.normalsTextureId){if(!(n=this.textures[e.normalsTextureId]))return void console.error("Texture not found: ".concat(e.normalsTextureId," - ensure that you create it first with createTexture()"));n.channel=2}if(void 0!==e.emissiveTextureId&&null!==e.emissiveTextureId){if(!(i=this.textures[e.emissiveTextureId]))return void console.error("Texture not found: ".concat(e.emissiveTextureId," - ensure that you create it first with createTexture()"));i.channel=3}if(void 0!==e.occlusionTextureId&&null!==e.occlusionTextureId){if(!(o=this.textures[e.occlusionTextureId]))return void console.error("Texture not found: ".concat(e.occlusionTextureId," - ensure that you create it first with createTexture()"));o.channel=4}var a=new Pe({textureSetId:e.textureSetId,textureSetIndex:this.textureSetsList.length,colorTexture:t,metallicRoughnessTexture:r,normalsTexture:n,emissiveTexture:i,occlusionTexture:o});return this.textureSets[e.textureSetId]=a,this.textureSetsList.push(a),a}console.error("XKTTextureSet already exists with this ID: "+e.textureSetId)}}},{key:"createGeometry",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.geometryId||void 0===e.geometryId)throw"Parameter expected: params.geometryId";if(!e.primitiveType)throw"Parameter expected: params.primitiveType";if(!e.positions)throw"Parameter expected: params.positions";var t="triangles"===e.primitiveType,r="points"===e.primitiveType,n="lines"===e.primitiveType;if(!t&&!r&&!n)throw"Unsupported value for params.primitiveType: "+e.primitiveType+"' - supported values are 'triangles', 'points' and 'lines'";if(t&&!e.indices)throw"Parameter expected for 'triangles' primitive: params.indices";if(r&&!e.colors&&!e.colorsCompressed)throw"Parameter expected for 'points' primitive: params.colors or params.colorsCompressed";if(n&&!e.indices)throw"Parameter expected for 'lines' primitive: params.indices";if(this.finalized)console.error("XKTModel has been finalized, can't add more geometries");else{if(!this.geometries[e.geometryId]){var i=e.geometryId,o=e.primitiveType,a=new Float64Array(e.positions),s={geometryId:i,geometryIndex:this.geometriesList.length,primitiveType:o,positions:a,uvs:e.uvs||e.uv};if(t&&(e.normals&&(s.normals=new Float32Array(e.normals)),s.indices=e.indices),r)if(e.colorsCompressed)s.colorsCompressed=new Uint8Array(e.colorsCompressed);else{for(var u=e.colors,c=new Uint8Array(u.length),l=0,h=u.length;l<h;l++)c[l]=Math.floor(255*u[l]);s.colorsCompressed=c}if(n&&(s.indices=e.indices),t){if(!e.normals&&!e.uv&&!e.uvs){var f=[],d=[];!function(e,t,r,n){for(var i={},o=[],a=Math.pow(10,4),s=0,u=e.length;s<u;s+=3){var c=e[s],l=e[s+1],h=e[s+2],f="".concat(Math.round(c*a),"_").concat(Math.round(l*a),"_").concat(Math.round(h*a));void 0===i[f]&&(i[f]=r.length/3,r.push(c),r.push(l),r.push(h)),o[s/3]=i[f]}for(var d=0,p=t.length;d<p;d++)n[d]=o[t[d]]}(s.positions,s.indices,f,d),s.positions=new Float64Array(f),s.indices=d}s.edgeIndices=re(s.positions,s.indices,null,e.edgeThreshold||this.edgeThreshold||10)}var p=new ue(s);return this.geometries[i]=p,this.geometriesList.push(p),p}console.error("XKTGeometry already exists with this ID: "+e.geometryId)}}},{key:"createMesh",value:function(e){if(null===e.meshId||void 0===e.meshId)throw"Parameter expected: params.meshId";if(null===e.geometryId||void 0===e.geometryId)throw"Parameter expected: params.geometryId";if(this.finalized)throw"XKTModel has been finalized, can't add more meshes";if(this.meshes[e.meshId])console.error("XKTMesh already exists with this ID: "+e.meshId);else{var t=this.geometries[e.geometryId];if(t){t.numInstances++;var r=null;if(e.textureSetId){if(!(r=this.textureSets[e.textureSetId]))return void console.error("XKTTextureSet not found: "+e.textureSetId);r.numInstances++}var n=e.matrix;if(!n){var i=e.position,o=e.scale,a=e.rotation;if(i||o||a){n=k.identityMat4();var s=k.eulerToQuaternion(a||[0,0,0],"XYZ",k.identityQuaternion());k.composeMat4(i||[0,0,0],s,o||[1,1,1],n)}else n=k.identityMat4()}var u=this.meshesList.length,c=new ae({meshId:e.meshId,meshIndex:u,matrix:n,geometry:t,color:e.color,metallic:e.metallic,roughness:e.roughness,opacity:e.opacity,textureSet:r});return this.meshes[c.meshId]=c,this.meshesList.push(c),c}console.error("XKTGeometry not found: "+e.geometryId)}}},{key:"createEntity",value:function(e){if(!e)throw"Parameters expected: params";if(null===e.entityId||void 0===e.entityId)throw"Parameter expected: params.entityId";if(!e.meshIds)throw"Parameter expected: params.meshIds";if(this.finalized)console.error("XKTModel has been finalized, can't add more entities");else{if(0!==e.meshIds.length){var t=e.entityId;if(this.entities[t]){for(;this.entities[t];)t=k.createUUID();console.error("XKTEntity already exists with this ID: "+e.entityId+" - substituting random ID instead: "+t)}for(var r=e.meshIds,n=[],i=0,o=r.length;i<o;i++){var a=r[i],s=this.meshes[a];s?s.entity?console.error("XKTMesh "+a+" already used by XKTEntity "+s.entity.entityId):n.push(s):console.error("XKTMesh found: "+a)}for(var u=new he(t,n),c=0,l=n.length;c<l;c++)n[c].entity=u;return this.entities[t]=u,this.entitiesList.push(u),u}console.warn("XKTEntity has no meshes - won't create: "+e.entityId)}}},{key:"createDefaultMetaObjects",value:function(){for(var e=0,t=this.entitiesList.length;e<t;e++){var r=this.entitiesList[e].entityId;this.metaObjects[r]||(this._rootMetaObject||(this._rootMetaObject=this.createMetaObject({metaObjectId:this.modelId,metaObjectType:"Default",metaObjectName:this.modelId})),this.createMetaObject({metaObjectId:r,metaObjectType:"Default",metaObjectName:""+r,parentMetaObjectId:this._rootMetaObject.metaObjectId}))}}},{key:"finalize",value:(n=ke().mark((function e(){var t;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.finalized){e.next=3;break}return console.log("XKTModel already finalized"),e.abrupt("return");case 3:return this._removeUnusedTextures(),e.next=6,this._compressTextures();case 6:this._bakeSingleUseGeometryPositions(),this._bakeAndOctEncodeNormals(),this._createEntityAABBs(),t=this._createKDTree(),this.entitiesList=[],this._createTilesFromKDTree(t),this._createReusedGeometriesDecodeMatrix(),this._flagSolidGeometries(),this.aabb.set(t.aabb),this.finalized=!0;case 16:case"end":return e.stop()}}),e,this)})),i=function(){var e=this,t=arguments;return new Promise((function(r,i){var o=n.apply(e,t);function a(e){De(o,r,i,a,s,"next",e)}function s(e){De(o,r,i,a,s,"throw",e)}a(void 0)}))},function(){return i.apply(this,arguments)})},{key:"_removeUnusedTextures",value:function(){for(var e=[],t={},r=0,n=this.texturesList.length;r<n;r++){var i=this.texturesList[r];null!==i.channel&&(i.textureIndex=e.length,e.push(i),t[i.textureId]=i)}this.texturesList=e,this.textures=t}},{key:"_compressTextures",value:function(){var e=this,t=this.texturesList.length;return new Promise((function(r){if(0!==t)for(var n=function(n,i){var o=e.texturesList[n],a=Xe[o.channel]||{};if(o.src){var s=o.src;switch(s.split(".").pop()){case"jpeg":case"jpg":case"png":(0,Ee.load)(s,Ge.ImageLoader,{image:{type:"data"}}).then((function(e){o.compressed?(0,Ee.encode)(e,je.KTX2BasisWriter,a).then((function(e){var n=new Uint8Array(e);o.imageData=n,--t<=0&&r()})).catch((function(e){console.error("[XKTModel.finalize] Failed to encode image: "+e),--t<=0&&r()})):(o.imageData=new Uint8Array(1),--t<=0&&r())})).catch((function(e){console.error("[XKTModel.finalize] Failed to load image: "+e),--t<=0&&r()}));break;default:--t<=0&&r()}}o.imageData&&(o.compressed?(0,Ee.encode)(o.imageData,je.KTX2BasisWriter,a).then((function(e){o.imageData=new Uint8Array(e),--t<=0&&r()})).catch((function(e){console.error("[XKTModel.finalize] Failed to encode image: "+e),--t<=0&&r()})):(o.imageData=new Uint8Array(1),--t<=0&&r()))},i=0,o=e.texturesList.length;i<o;i++)n(i);else r()}))}},{key:"_bakeSingleUseGeometryPositions",value:function(){for(var e=0,t=this.meshesList.length;e<t;e++){var r=this.meshesList[e],n=r.geometry;if(1===n.numInstances){var i=r.matrix;if(i&&!k.isIdentityMat4(i))for(var o=n.positions,a=0,s=o.length;a<s;a+=3)Ve[0]=o[a+0],Ve[1]=o[a+1],Ve[2]=o[a+2],Ve[3]=1,k.transformPoint4(i,Ve,Ce),o[a+0]=Ce[0],o[a+1]=Ce[1],o[a+2]=Ce[2]}}}},{key:"_bakeAndOctEncodeNormals",value:function(){for(var e=0,t=this.meshesList.length;e<t;e++){var r=this.meshesList[e],n=r.geometry;if(n.normals&&!n.normalsOctEncoded)if(n.normalsOctEncoded=new Int8Array(n.normals.length),n.numInstances>1)te.octEncodeNormals(n.normals,n.normals.length,n.normalsOctEncoded,0);else{var i=k.inverseMat4(k.transposeMat4(r.matrix,Be),Ue);te.transformAndOctEncodeNormals(i,n.normals,n.normals.length,n.normalsOctEncoded,0)}}}},{key:"_createEntityAABBs",value:function(){for(var e=0,t=this.entitiesList.length;e<t;e++){var r=this.entitiesList[e],n=r.aabb,i=r.meshes;k.collapseAABB3(n);for(var o=0,a=i.length;o<a;o++){var s=i[o],u=s.geometry,c=s.matrix;if(u.numInstances>1)for(var l=u.positions,h=0,f=l.length;h<f;h+=3)Ve[0]=l[h+0],Ve[1]=l[h+1],Ve[2]=l[h+2],Ve[3]=1,k.transformPoint4(c,Ve,Ce),k.expandAABB3Point3(n,Ce);else for(var d=u.positions,p=0,v=d.length;p<v;p+=3)Ve[0]=d[p+0],Ve[1]=d[p+1],Ve[2]=d[p+2],k.expandAABB3Point3(n,Ve)}}}},{key:"_createKDTree",value:function(){for(var e=k.collapseAABB3(),t=0,r=this.entitiesList.length;t<r;t++){var n=this.entitiesList[t];k.expandAABB3(e,n.aabb)}for(var i=new ye(e),o=0,a=this.entitiesList.length;o<a;o++){var s=this.entitiesList[o];this._insertEntityIntoKDTree(i,s)}return i}},{key:"_insertEntityIntoKDTree",value:function(e,t){var r=e.aabb,n=t.aabb;if(k.getAABB3Diag(r)<this.minTileSize)return e.entities=e.entities||[],e.entities.push(t),void k.expandAABB3(r,n);if(e.left&&k.containsAABB3(e.left.aabb,n))this._insertEntityIntoKDTree(e.left,t);else if(e.right&&k.containsAABB3(e.right.aabb,n))this._insertEntityIntoKDTree(e.right,t);else{ze[0]=r[3]-r[0],ze[1]=r[4]-r[1],ze[2]=r[5]-r[2];var i=0;if(ze[1]>ze[i]&&(i=1),ze[2]>ze[i]&&(i=2),!e.left){var o=r.slice();if(o[i+3]=(r[i]+r[i+3])/2,e.left=new ye(o),k.containsAABB3(o,n))return void this._insertEntityIntoKDTree(e.left,t)}if(!e.right){var a=r.slice();if(a[i]=(r[i]+r[i+3])/2,e.right=new ye(a),k.containsAABB3(a,n))return void this._insertEntityIntoKDTree(e.right,t)}e.entities=e.entities||[],e.entities.push(t),k.expandAABB3(r,n)}}},{key:"_createTilesFromKDTree",value:function(e){this._createTilesFromKDNode(e)}},{key:"_createTilesFromKDNode",value:function(e){e.entities&&e.entities.length>0&&this._createTileFromEntities(e.entities),e.left&&this._createTilesFromKDNode(e.left),e.right&&this._createTilesFromKDNode(e.right)}},{key:"_createTileFromEntities",value:function(e){var t=k.AABB3();k.collapseAABB3(t);for(var r=0;r<e.length;r++){var n=e[r];k.expandAABB3(t,n.aabb)}var i=k.getAABB3Center(t),o=k.mulVec3Scalar(i,-1,k.vec3()),a=k.AABB3();a[0]=t[0]-i[0],a[1]=t[1]-i[1],a[2]=t[2]-i[2],a[3]=t[3]-i[0],a[4]=t[4]-i[1],a[5]=t[5]-i[2];for(var s=0;s<e.length;s++){for(var u=e[s],c=u.meshes,l=0,h=c.length;l<h;l++){var f=c[l],d=f.geometry;if(d.reused)k.translateMat4v(o,f.matrix);else{for(var p=d.positions,v=0,m=p.length;v<m;v+=3)p[v+0]-=i[0],p[v+1]-=i[1],p[v+2]-=i[2];te.quantizePositions(p,p.length,a,d.positionsQuantized)}}u.entityIndex=this.entitiesList.length,this.entitiesList.push(u)}var y=new pe(t,e);this.tilesList.push(y)}},{key:"_createReusedGeometriesDecodeMatrix",value:function(){for(var e=k.vec3(),t=k.collapseAABB3(k.AABB3()),r=0,n=0,i=this.geometriesList.length;n<i;n++){var o=this.geometriesList[n];if(o.reused){for(var a=o.positions,s=0,u=a.length;s<u;s+=3)e[0]=a[s],e[1]=a[s+1],e[2]=a[s+2],k.expandAABB3Point3(t,e);r++}}if(r>0){te.createPositionsDecodeMatrix(t,this.reusedGeometriesDecodeMatrix);for(var c=0,l=this.geometriesList.length;c<l;c++){var h=this.geometriesList[c];h.reused&&te.quantizePositions(h.positions,h.positions.length,t,h.positionsQuantized)}}else k.identityMat4(this.reusedGeometriesDecodeMatrix)}},{key:"_flagSolidGeometries",value:function(){for(var e=0,t=0,r=0,n=this.geometriesList.length;r<n;r++){var i=this.geometriesList[r];"triangles"===i.primitiveType&&(i.positionsQuantized.length>e&&(e=i.positionsQuantized.length),i.indices.length>t&&(t=i.indices.length))}for(var o=new Array(e/3),a=new Array(t),s=0,u=this.geometriesList.length;s<u;s++){var c=this.geometriesList[s];"triangles"===c.primitiveType&&(c.solid=ne(c.indices,c.positionsQuantized,o,a))}}}],r&&Ne(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const Ke=require("pako");var qe=f.xktVersion;function Ze(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Ye(e,t,r),i=Qe(n,t);r.texturesSize+=i.textureData.byteLength;var o=We(i);return o}function Ye(e,t,r){for(var n=e.propertySetsList,i=e.metaObjectsList,o=e.geometriesList,a=e.texturesList,s=e.textureSetsList,u=e.meshesList,c=e.entitiesList,l=e.tilesList,h=n.length,f=i.length,d=o.length,p=a.length,v=s.length,m=u.length,y=c.length,g=l.length,x=0,w=0,b=0,M=0,I=0,T=0,A=0,S=0,O=0;O<d;O++){var L=o[O];L.positionsQuantized&&(x+=L.positionsQuantized.length),L.normalsOctEncoded&&(w+=L.normalsOctEncoded.length),L.colorsCompressed&&(b+=L.colorsCompressed.length),L.uvs&&(M+=L.uvs.length),L.indices&&(I+=L.indices.length),L.edgeIndices&&(T+=L.edgeIndices.length)}for(var P=0;P<p;P++){var E=a[P];S+=E.imageData.byteLength,E.compressed&&r.numCompressedTextures++}for(var j=0;j<m;j++)u[j].geometry.numInstances>1&&(A+=16);var G={metadata:{},textureData:new Uint8Array(S),eachTextureDataPortion:new Uint32Array(p),eachTextureAttributes:new Uint16Array(9*p),positions:new Uint16Array(x),normals:new Int8Array(w),colors:new Uint8Array(b),uvs:new Float32Array(M),indices:new Uint32Array(I),edgeIndices:new Uint32Array(T),eachTextureSetTextures:new Int32Array(5*v),matrices:new Float32Array(A),reusedGeometriesDecodeMatrix:new Float32Array(e.reusedGeometriesDecodeMatrix),eachGeometryPrimitiveType:new Uint8Array(d),eachGeometryPositionsPortion:new Uint32Array(d),eachGeometryNormalsPortion:new Uint32Array(d),eachGeometryColorsPortion:new Uint32Array(d),eachGeometryUVsPortion:new Uint32Array(d),eachGeometryIndicesPortion:new Uint32Array(d),eachGeometryEdgeIndicesPortion:new Uint32Array(d),eachMeshGeometriesPortion:new Uint32Array(m),eachMeshMatricesPortion:new Uint32Array(m),eachMeshTextureSet:new Int32Array(m),eachMeshMaterialAttributes:new Uint8Array(6*m),eachEntityId:[],eachEntityMeshesPortion:new Uint32Array(y),eachTileAABB:new Float64Array(6*g),eachTileEntitiesPortion:new Uint32Array(g)},_=0,k=0,D=0,F=0,N=0,V=0;G.metadata={id:e.modelId,projectId:e.projectId,revisionId:e.revisionId,author:e.author,createdAt:e.createdAt,creatingApplication:e.creatingApplication,schema:e.schema,propertySets:[],metaObjects:[]};for(var C=0;C<h;C++){var B=n[C],U={id:""+B.propertySetId,name:B.propertySetName,type:B.propertySetType,properties:B.properties};G.metadata.propertySets.push(U)}if(!t)for(var z=0;z<f;z++){var X=i[z],R={name:X.metaObjectName,type:X.metaObjectType,id:""+X.metaObjectId};void 0!==X.parentMetaObjectId&&null!==X.parentMetaObjectId&&(R.parent=""+X.parentMetaObjectId),X.propertySetIds&&X.propertySetIds.length>0&&(R.propertySetIds=X.propertySetIds),X.external&&(R.external=X.external),G.metadata.metaObjects.push(R)}for(var K=0;K<d;K++){var q=o[K],Z="triangles"===q.primitiveType?q.solid?0:1:"points"===q.primitiveType?2:3;G.eachGeometryPrimitiveType[K]=Z,G.eachGeometryPositionsPortion[K]=_,G.eachGeometryNormalsPortion[K]=k,G.eachGeometryColorsPortion[K]=D,G.eachGeometryUVsPortion[K]=F,G.eachGeometryIndicesPortion[K]=N,G.eachGeometryEdgeIndicesPortion[K]=V,q.positionsQuantized&&(G.positions.set(q.positionsQuantized,_),_+=q.positionsQuantized.length),q.normalsOctEncoded&&(G.normals.set(q.normalsOctEncoded,k),k+=q.normalsOctEncoded.length),q.colorsCompressed&&(G.colors.set(q.colorsCompressed,D),D+=q.colorsCompressed.length),q.uvs&&(G.uvs.set(q.uvs,F),F+=q.uvs.length),q.indices&&(G.indices.set(q.indices,N),N+=q.indices.length),q.edgeIndices&&(G.edgeIndices.set(q.edgeIndices,V),V+=q.edgeIndices.length)}for(var Y=0,Q=e.texturesList.length,W=0;Y<Q;Y++){var J=e.texturesList[Y],H=J.imageData;G.textureData.set(H,W),G.eachTextureDataPortion[Y]=W,W+=H.byteLength;var $=9*Y;G.eachTextureAttributes[$++]=J.compressed?1:0,G.eachTextureAttributes[$++]=J.mediaType,G.eachTextureAttributes[$++]=J.width,G.eachTextureAttributes[$++]=J.height,G.eachTextureAttributes[$++]=J.minFilter,G.eachTextureAttributes[$++]=J.magFilter,G.eachTextureAttributes[$++]=J.wrapS,G.eachTextureAttributes[$++]=J.wrapT,G.eachTextureAttributes[$++]=J.wrapR}for(var ee=0,te=e.textureSetsList.length,re=0;ee<te;ee++){var ne=s[ee];G.eachTextureSetTextures[re++]=ne.colorTexture?ne.colorTexture.textureIndex:-1,G.eachTextureSetTextures[re++]=ne.metallicRoughnessTexture?ne.metallicRoughnessTexture.textureIndex:-1,G.eachTextureSetTextures[re++]=ne.normalsTexture?ne.normalsTexture.textureIndex:-1,G.eachTextureSetTextures[re++]=ne.emissiveTexture?ne.emissiveTexture.textureIndex:-1,G.eachTextureSetTextures[re++]=ne.occlusionTexture?ne.occlusionTexture.textureIndex:-1}for(var ie=0,oe=0,ae=0,se=0,ue=0,ce=0;ce<g;ce++){var le=l[ce],he=le.entities,fe=he.length;if(0!==fe){G.eachTileEntitiesPortion[ce]=ie;for(var de=le.aabb,pe=0;pe<fe;pe++){for(var ve=he[pe],me=ve.meshes,ye=me.length,ge=0;ge<ye;ge++){var xe=me[ge],we=xe.geometry.geometryIndex;G.eachMeshGeometriesPortion[oe+ge]=we,xe.geometry.numInstances>1&&(G.matrices.set(xe.matrix,se),G.eachMeshMatricesPortion[ue]=se,se+=16),G.eachMeshTextureSet[ue]=xe.textureSet?xe.textureSet.textureSetIndex:-1,G.eachMeshMaterialAttributes[ae++]=255*xe.color[0],G.eachMeshMaterialAttributes[ae++]=255*xe.color[1],G.eachMeshMaterialAttributes[ae++]=255*xe.color[2],G.eachMeshMaterialAttributes[ae++]=255*xe.opacity,G.eachMeshMaterialAttributes[ae++]=255*xe.metallic,G.eachMeshMaterialAttributes[ae++]=255*xe.roughness,ue++}G.eachEntityId[ie]=ve.entityId,G.eachEntityMeshesPortion[ie]=oe,ie++,oe+=ye}var be=6*ce;G.eachTileAABB.set(de,be)}}return G}function Qe(e,t){return{metadata:t?Ke.deflate(t.buffer):Ke.deflate((r=e.metadata,JSON.stringify(r).replace(/[\u007F-\uFFFF]/g,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)})))),textureData:Ke.deflate(e.textureData.buffer),eachTextureDataPortion:Ke.deflate(e.eachTextureDataPortion.buffer),eachTextureAttributes:Ke.deflate(e.eachTextureAttributes.buffer),positions:Ke.deflate(e.positions.buffer),normals:Ke.deflate(e.normals.buffer),colors:Ke.deflate(e.colors.buffer),uvs:Ke.deflate(e.uvs.buffer),indices:Ke.deflate(e.indices.buffer),edgeIndices:Ke.deflate(e.edgeIndices.buffer),eachTextureSetTextures:Ke.deflate(e.eachTextureSetTextures.buffer),matrices:Ke.deflate(e.matrices.buffer),reusedGeometriesDecodeMatrix:Ke.deflate(e.reusedGeometriesDecodeMatrix.buffer),eachGeometryPrimitiveType:Ke.deflate(e.eachGeometryPrimitiveType.buffer),eachGeometryPositionsPortion:Ke.deflate(e.eachGeometryPositionsPortion.buffer),eachGeometryNormalsPortion:Ke.deflate(e.eachGeometryNormalsPortion.buffer),eachGeometryColorsPortion:Ke.deflate(e.eachGeometryColorsPortion.buffer),eachGeometryUVsPortion:Ke.deflate(e.eachGeometryUVsPortion.buffer),eachGeometryIndicesPortion:Ke.deflate(e.eachGeometryIndicesPortion.buffer),eachGeometryEdgeIndicesPortion:Ke.deflate(e.eachGeometryEdgeIndicesPortion.buffer),eachMeshGeometriesPortion:Ke.deflate(e.eachMeshGeometriesPortion.buffer),eachMeshMatricesPortion:Ke.deflate(e.eachMeshMatricesPortion.buffer),eachMeshTextureSet:Ke.deflate(e.eachMeshTextureSet.buffer),eachMeshMaterialAttributes:Ke.deflate(e.eachMeshMaterialAttributes.buffer),eachEntityId:Ke.deflate(JSON.stringify(e.eachEntityId).replace(/[\u007F-\uFFFF]/g,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)}))),eachEntityMeshesPortion:Ke.deflate(e.eachEntityMeshesPortion.buffer),eachTileAABB:Ke.deflate(e.eachTileAABB.buffer),eachTileEntitiesPortion:Ke.deflate(e.eachTileEntitiesPortion.buffer)};var r}function We(e){return function(e){var t=new Uint32Array(e.length+2);t[0]=qe,t[1]=e.length;for(var r=0,n=0,i=e.length;n<i;n++){var o=e[n].length;t[n+2]=o,r+=o}var a=new Uint8Array(t.buffer),s=new Uint8Array(a.length+r);s.set(a);for(var u=a.length,c=0,l=e.length;c<l;c++){var h=e[c];s.set(h,u),u+=h.length}return s.buffer}([e.metadata,e.textureData,e.eachTextureDataPortion,e.eachTextureAttributes,e.positions,e.normals,e.colors,e.uvs,e.indices,e.edgeIndices,e.eachTextureSetTextures,e.matrices,e.reusedGeometriesDecodeMatrix,e.eachGeometryPrimitiveType,e.eachGeometryPositionsPortion,e.eachGeometryNormalsPortion,e.eachGeometryColorsPortion,e.eachGeometryUVsPortion,e.eachGeometryIndicesPortion,e.eachGeometryEdgeIndicesPortion,e.eachMeshGeometriesPortion,e.eachMeshMatricesPortion,e.eachMeshTextureSet,e.eachMeshMaterialAttributes,e.eachEntityId,e.eachEntityMeshesPortion,e.eachTileAABB,e.eachTileEntitiesPortion])}function Je(e,t,r){r=r||2;var n,i,o,a,s,u,c,l=t&&t.length,h=l?t[0]*r:e.length,f=He(e,0,h,r,!0),d=[];if(!f||f.next===f.prev)return d;if(l&&(f=function(e,t,r,n){var i,o,a,s=[];for(i=0,o=t.length;i<o;i++)(a=He(e,t[i]*n,i<o-1?t[i+1]*n:e.length,n,!1))===a.next&&(a.steiner=!0),s.push(ct(a));for(s.sort(ot),i=0;i<s.length;i++)at(s[i],r),r=$e(r,r.next);return r}(e,t,f,r)),e.length>80*r){n=o=e[0],i=a=e[1];for(var p=r;p<h;p+=r)(s=e[p])<n&&(n=s),(u=e[p+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);c=0!==(c=Math.max(o-n,a-i))?1/c:0}return et(f,d,r,n,i,c),d}function He(e,t,r,n,i){var o,a;if(i===Mt(e,t,r,n)>0)for(o=t;o<r;o+=n)a=xt(o,e[o],e[o+1],a);else for(o=r-n;o>=t;o-=n)a=xt(o,e[o],e[o+1],a);return a&&dt(a,a.next)&&(wt(a),a=a.next),a}function $e(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!dt(n,n.next)&&0!==ft(n.prev,n,n.next))n=n.next;else{if(wt(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function et(e,t,r,n,i,o,a){if(e){!a&&o&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=ut(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,a,s,u,c=1;do{for(r=e,e=null,o=null,a=0;r;){for(a++,n=r,s=0,t=0;t<c&&(s++,n=n.nextZ);t++);for(u=c;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(a>1)}(i)}(e,n,i,o);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,o?rt(e,n,i,o):tt(e))t.push(s.i/r),t.push(e.i/r),t.push(u.i/r),wt(e),e=u.next,c=u.next;else if((e=u)===c){a?1===a?et(e=nt($e(e),t,r),t,r,n,i,o,2):2===a&&it(e,t,r,n,i,o):et($e(e),t,r,n,i,o,1);break}}}function tt(e){var t=e.prev,r=e,n=e.next;if(ft(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(lt(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&ft(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function rt(e,t,r,n){var i=e.prev,o=e,a=e.next;if(ft(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=ut(s,u,t,r,n),f=ut(c,l,t,r,n),d=e.prevZ,p=e.nextZ;d&&d.z>=h&&p&&p.z<=f;){if(d!==e.prev&&d!==e.next&&lt(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&ft(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&lt(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&ft(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&lt(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&ft(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&lt(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&ft(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function nt(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!dt(i,o)&&pt(i,n,n.next,o)&&yt(i,o)&&yt(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),wt(n),wt(n.next),n=e=o),n=n.next}while(n!==e);return $e(n)}function it(e,t,r,n,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&ht(a,s)){var u=gt(a,s);return a=$e(a,a.next),u=$e(u,u.next),et(a,t,r,n,i,o),void et(u,t,r,n,i,o)}s=s.next}a=a.next}while(a!==e)}function ot(e,t){return e.x-t.x}function at(e,t){if(t=function(e,t){var r,n=t,i=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r;var u,c=r,l=r.x,h=r.y,f=1/0;n=r;do{i>=n.x&&n.x>=l&&i!==n.x&&lt(o<h?i:a,o,l,h,o<h?a:i,o,n.x,n.y)&&(u=Math.abs(o-n.y)/(i-n.x),yt(n,e)&&(u<f||u===f&&(n.x>r.x||n.x===r.x&&st(r,n)))&&(r=n,f=u)),n=n.next}while(n!==c);return r}(e,t),t){var r=gt(t,e);$e(t,t.next),$e(r,r.next)}}function st(e,t){return ft(e.prev,e,t.prev)<0&&ft(t.next,e,e.next)<0}function ut(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ct(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function lt(e,t,r,n,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(n-s)-(r-a)*(t-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function ht(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&pt(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(yt(e,t)&&yt(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(ft(e.prev,e,t.prev)||ft(e,t.prev,t))||dt(e,t)&&ft(e.prev,e,e.next)>0&&ft(t.prev,t,t.next)>0)}function ft(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function dt(e,t){return e.x===t.x&&e.y===t.y}function pt(e,t,r,n){var i=mt(ft(e,t,r)),o=mt(ft(e,t,n)),a=mt(ft(r,n,e)),s=mt(ft(r,n,t));return i!==o&&a!==s||!(0!==i||!vt(e,r,t))||!(0!==o||!vt(e,n,t))||!(0!==a||!vt(r,e,n))||!(0!==s||!vt(r,t,n))}function vt(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function mt(e){return e>0?1:e<0?-1:0}function yt(e,t){return ft(e.prev,e,e.next)<0?ft(e,t,e.next)>=0&&ft(e,e.prev,t)>=0:ft(e,t,e.prev)<0||ft(e,e.next,t)<0}function gt(e,t){var r=new bt(e.i,e.x,e.y),n=new bt(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function xt(e,t,r,n){var i=new bt(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function wt(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function bt(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mt(e,t,r,n){for(var i=0,o=t,a=r-n;o<r;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}function It(e){return function(e){if(Array.isArray(e))return Tt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Tt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Tt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Je.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,a=Math.abs(Mt(e,0,o,r));if(i)for(var s=0,u=t.length;s<u;s++){var c=t[s]*r,l=s<u-1?t[s+1]*r:e.length;a-=Math.abs(Mt(e,c,l,r))}var h=0;for(s=0;s<n.length;s+=3){var f=n[s]*r,d=n[s+1]*r,p=n[s+2]*r;h+=Math.abs((e[f]-e[p])*(e[d+1]-e[f+1])-(e[f]-e[d])*(e[p+1]-e[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},Je.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)r.vertices.push(e[i][o][a]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r};var At=k.vec2(),St=k.vec3(),Ot=k.vec3(),Lt=k.vec3();function Pt(e){var t=e.data,r=e.xktModel,n=e.stats,i=void 0===n?{}:n,o=e.log;return new Promise((function(e,n){if(t)if("CityJSON"===t.type)if(r){var a=t.transform?function(e,t){for(var r=[],n=t.scale||k.vec3([1,1,1]),i=t.translate||k.vec3([0,0,0]),o=0,a=0;o<e.length;o++,a+=3){var s=e[o][0]*n[0]+i[0],u=e[o][1]*n[1]+i[1],c=e[o][2]*n[2]+i[2];r.push([s,u,c])}return r}(t.vertices,t.transform):t.vertices;i.sourceFormat=t.type||"",i.schemaVersion=t.version||"",i.title="",i.author="",i.created="",i.numMetaObjects=0,i.numPropertySets=0,i.numTriangles=0,i.numVertices=0,i.numObjects=0,i.numGeometries=0;var s=k.createUUID();r.createMetaObject({metaObjectId:s,metaObjectType:"Model",metaObjectName:"Model"}),i.numMetaObjects++;var u=k.createUUID();r.createMetaObject({metaObjectId:u,metaObjectType:"CityJSON",metaObjectName:"CityJSON",parentMetaObjectId:s}),i.numMetaObjects++;var c={data:t,vertices:a,xktModel:r,rootMetaObjectId:u,log:o||function(e){},nextId:0,stats:i};c.log("Using parser: parseCityJSONIntoXKTModel"),c.xktModel.schema=t.type+" "+t.version,c.log("Converting "+c.xktModel.schema),function(e){var t=e.data.CityObjects;for(var r in t)t.hasOwnProperty(r)&&Et(e,t[r],r)}(c),e()}else n("Argument expected: xktModel");else n("Invalid argument: data is not a CityJSON file");else n("Argument expected: data")}))}function Et(e,t,r){var n=e.xktModel,i=e.data,o=r,a=t.type,s=a+" : "+r,u=t.parents?t.parents[0]:e.rootMetaObjectId;if(n.createMetaObject({metaObjectId:o,metaObjectName:s,metaObjectType:a,parentMetaObjectId:u}),e.stats.numMetaObjects++,t.geometry&&t.geometry.length>0){for(var c=[],l=0,h=t.geometry.length;l<h;l++){var f=t.geometry[l],d=void 0,p=void 0,v=i.appearance;if(v){var m=v.materials;if(m){var y=f.material;if(y){var g=Object.keys(y);if(g.length>0){var x=y[g[0]];if(void 0!==x.value)d=m[x.value];else{var w=x.values;if(w){p=[];for(var b=0,M=w.length;b<M;b++){var I=m[w[l]];p.push(I)}}}}}}}p?jt(e,f,p,c):_t(e,f,d,c)}c.length>0&&(n.createEntity({entityId:r,meshIds:c}),e.stats.numObjects++)}}function jt(e,t,r,n){switch(t.type){case"MultiPoint":case"MultiLineString":case"GeometryInstance":break;case"MultiSurface":case"CompositeSurface":Gt(e,r,t.boundaries,n);break;case"Solid":for(var i=t.boundaries,o=0;o<i.length;o++)Gt(e,r,i[o],n);break;case"MultiSolid":case"CompositeSolid":for(var a=t.boundaries,s=0;s<a.length;s++)for(var u=0;u<a[s].length;u++)Gt(e,r,a[s][u],n)}}function Gt(e,t,r,n){for(var i=e.vertices,o=e.xktModel,a=0;a<r.length;a++){for(var s=r[a],u=t[a]||{diffuseColor:[.8,.8,.8],transparency:1},c=[],l=[],h=[],f={positions:[],indices:[]},d=0;d<s.length;d++){c.length>0&&l.push(c.length);var p=Dt(e,s[d],h,f);c.push.apply(c,It(p))}if(3===c.length)f.indices.push(c[0]),f.indices.push(c[1]),f.indices.push(c[2]);else if(c.length>3){for(var v=[],m=0;m<c.length;m++)v.push({x:i[h[c[m]]][0],y:i[h[c[m]]][1],z:i[h[c[m]]][2]});for(var y=Ft(v,k.vec3()),g=[],x=0;x<v.length;x++)Nt(v[x],y,At),g.unshift(At[0]),g.unshift(At[1]);for(var w=Je(g,l,2),b=0;b<w.length;b+=3)f.indices.unshift(c[w[b]]),f.indices.unshift(c[w[b+1]]),f.indices.unshift(c[w[b+2]])}var M=""+e.nextId++,I=""+e.nextId++;o.createGeometry({geometryId:M,primitiveType:"triangles",positions:f.positions,indices:f.indices}),o.createMesh({meshId:I,geometryId:M,color:u&&u.diffuseColor?u.diffuseColor:[.8,.8,.8],opacity:1}),n.push(I),e.stats.numGeometries++,e.stats.numVertices+=f.positions.length/3,e.stats.numTriangles+=f.indices.length/3}}function _t(e,t,r,n){var i=e.xktModel,o=[],a={positions:[],indices:[]};switch(t.type){case"MultiPoint":case"MultiLineString":case"GeometryInstance":break;case"MultiSurface":case"CompositeSurface":kt(e,t.boundaries,o,a);break;case"Solid":for(var s=t.boundaries,u=0;u<s.length;u++)kt(e,s[u],o,a);break;case"MultiSolid":case"CompositeSolid":for(var c=t.boundaries,l=0;l<c.length;l++)for(var h=0;h<c[l].length;h++)kt(e,c[l][h],o,a)}var f=""+e.nextId++,d=""+e.nextId++;i.createGeometry({geometryId:f,primitiveType:"triangles",positions:a.positions,indices:a.indices}),i.createMesh({meshId:d,geometryId:f,color:r&&r.diffuseColor?r.diffuseColor:[.8,.8,.8],opacity:1}),n.push(d),e.stats.numGeometries++,e.stats.numVertices+=a.positions.length/3,e.stats.numTriangles+=a.indices.length/3}function kt(e,t,r,n){for(var i=e.vertices,o=0;o<t.length;o++){for(var a=[],s=[],u=0;u<t[o].length;u++){a.length>0&&s.push(a.length);var c=Dt(e,t[o][u],r,n);a.push.apply(a,It(c))}if(3===a.length)n.indices.push(a[0]),n.indices.push(a[1]),n.indices.push(a[2]);else if(a.length>3){for(var l=[],h=0;h<a.length;h++)l.push({x:i[r[a[h]]][0],y:i[r[a[h]]][1],z:i[r[a[h]]][2]});for(var f=Ft(l,k.vec3()),d=[],p=0;p<l.length;p++)Nt(l[p],f,At),d.unshift(At[0]),d.unshift(At[1]);for(var v=Je(d,s,2),m=0;m<v.length;m+=3)n.indices.unshift(a[v[m]]),n.indices.unshift(a[v[m+1]]),n.indices.unshift(a[v[m+2]])}}}function Dt(e,t,r,n){for(var i=e.vertices,o=[],a=0,s=t.length;a<s;a++){var u=t[a];if(r.includes(u)){var c=r.indexOf(u);o.push(c)}else n.positions.push(i[u][0]),n.positions.push(i[u][1]),n.positions.push(i[u][2]),o.push(r.length),r.push(u)}return o}function Ft(e,t){for(var r=0;r<e.length;r++){var n=r+1;n===e.length&&(n=0),t[0]+=(e[r].y-e[n].y)*(e[r].z+e[n].z),t[1]+=(e[r].z-e[n].z)*(e[r].x+e[n].x),t[2]+=(e[r].x-e[n].x)*(e[r].y+e[n].y)}return k.normalizeVec3(t)}function Nt(e,t,r){var n=St,i=Ot,o=Lt;n[0]=e.x,n[1]=e.y,n[2]=e.z,i[0]=t.x,i[1]=t.y,i[2]=t.z,o[0]=1.1,o[1]=1.1,o[2]=1.1,k.lenVec3(k.subVec3(o,i))<.01&&(o[0]+=1,o[1]+=2,o[2]+=3);var a=k.dotVec3(o,i),s=k.mulVec3Scalar(i,a,k.vec3());o[0]-=s[0],o[1]-=s[1],o[2]-=s[2],k.normalizeVec3(o);var u=k.cross3Vec3(i,o,k.vec3()),c=k.dotVec3(n,o),l=k.dotVec3(n,u);r[0]=c,r[1]=l}var Vt=function(e){return"string"==typeof e||e instanceof String};const Ct=require("@loaders.gl/gltf");function Bt(e){var t=e.data,r=e.baseUri,n=e.xktModel,i=e.metaModelData,o=e.includeTextures,a=void 0===o||o,s=e.includeNormals,u=void 0===s||s,c=e.getAttachment,l=e.stats,h=void 0===l?{}:l,f=e.log;return new Promise((function(e,o){t?n?(h.sourceFormat="glTF",h.schemaVersion="2.0",h.title="",h.author="",h.created="",h.numTriangles=0,h.numVertices=0,h.numNormals=0,h.numUVs=0,h.numTextures=0,h.numObjects=0,h.numGeometries=0,(0,Ee.parse)(t,Ct.GLTFLoader,{baseUri:r}).then((function(t){var r={gltfData:t,metaModelCorrections:i?Ut(i):null,getAttachment:c||function(){throw new Error("You must define getAttachment() method to convert glTF with external resources")},log:f||function(e){},error:function(e){console.error(e)},xktModel:n,includeNormals:!1!==u,includeTextures:!1!==a,geometryCreated:{},nextId:0,stats:h};r.log("Using parser: parseGLTFIntoXKTModel"),r.log("Parsing normals: ".concat(r.includeNormals?"enabled":"disabled")),r.log("Parsing textures: ".concat(r.includeTextures?"enabled":"disabled")),r.includeTextures&&function(e){var t=e.gltfData.textures;if(t)for(var r=0,n=t.length;r<n;r++)zt(e,t[r]),e.stats.numTextures++}(r),function(e){var t=e.gltfData.materials;if(t)for(var r=0,n=t.length;r<n;r++){var i=t[r];i._textureSetId=e.includeTextures?Xt(e,i):null,i._attributes=Rt(0,i)}}(r),function(e){var t=e.gltfData,r=t.scene||t.scenes[0];r?function(e,t){var r=t.nodes;if(r){for(var n=0,i=r.length;n<i;n++)Kt(e,r[n]);for(var o=0,a=r.length;o<a;o++)Zt(e,r[o],0,null)}}(e,r):e.error("glTF has no default scene")}(r),e()}),(function(e){o("[parseGLTFIntoXKTModel] ".concat(e))}))):o("Argument expected: xktModel"):o("Argument expected: data")}))}function Ut(e){for(var t={},r={},n=e.metaObjects||[],i={},o=0,a=n.length;o<a;o++){var s=n[o];i[s.id]=s}for(var u=0,c=n.length;u<c;u++){var l=n[u];if(void 0!==l.parent&&null!==l.parent){var h=i[l.parent];if(l.type===h.type){for(var f=h;f.parent&&i[f.parent].type===f.type;)f=i[f.parent];(t[f.id]||(t[f.id]={numChildren:0,countChildren:0})).numChildren++,r[l.id]=f}}}return{metaObjectsMap:i,eachRootStats:t,eachChildRoot:r}}function zt(e,t){if(t.source&&t.source.image){var r="texture-".concat(e.nextId++),n=b;switch(t.sampler.minFilter){case 9728:n=y;break;case 9729:n=M;break;case 9984:n=g;break;case 9985:n=T;break;case 9986:n=b;break;case 9987:n=S}var i=M;switch(t.sampler.magFilter){case 9728:i=y;break;case 9729:i=M}var o=d;switch(t.sampler.wrapS){case 33071:o=p;break;case 33648:o=m;break;case 10497:o=d}var a=d;switch(t.sampler.wrapT){case 33071:a=p;break;case 33648:a=m;break;case 10497:a=d}var s=d;switch(t.sampler.wrapR){case 33071:s=p;break;case 33648:s=m;break;case 10497:s=d}e.xktModel.createTexture({textureId:r,imageData:t.source.image,mediaType:t.source.mediaType,compressed:!0,width:t.source.image.width,height:t.source.image.height,minFilter:n,magFilter:i,wrapS:o,wrapT:a,wrapR:s,flipY:!!t.flipY}),t._textureId=r}}function Xt(e,t){var r={};t.normalTexture&&(r.normalTextureId=t.normalTexture.texture._textureId),t.occlusionTexture&&(r.occlusionTextureId=t.occlusionTexture.texture._textureId),t.emissiveTexture&&(r.emissiveTextureId=t.emissiveTexture.texture._textureId);var n=t.pbrMetallicRoughness;if(t.pbrMetallicRoughness){var i=t.pbrMetallicRoughness,o=i.baseColorTexture||i.colorTexture;o&&(o.texture?r.colorTextureId=o.texture._textureId:r.colorTextureId=e.gltfData.textures[o.index]._textureId),n.metallicRoughnessTexture&&(r.metallicRoughnessTextureId=n.metallicRoughnessTexture.texture._textureId)}var a=t.extensions;if(a){var s=a.KHR_materials_pbrSpecularGlossiness;if(s){s.specularTexture;var u=s.specularColorTexture;null!=u&&(r.colorTextureId=e.gltfData.textures[u.index]._textureId)}}return void 0!==r.normalTextureId||void 0!==r.occlusionTextureId||void 0!==r.emissiveTextureId||void 0!==r.colorTextureId||void 0!==r.metallicRoughnessTextureId?(r.textureSetId="textureSet-".concat(e.nextId++,";"),e.xktModel.createTextureSet(r),e.stats.numTextureSets++,r.textureSetId):null}function Rt(e,t){var r=t.extensions,n={color:new Float32Array([1,1,1,1]),opacity:1,metallic:0,roughness:1};if(r){var i=r.KHR_materials_pbrSpecularGlossiness;if(i){var o=i.diffuseFactor;null!=o&&n.color.set(o)}var a=r.KHR_materials_common;if(a){var s=a.technique,u=a.values||{},c="BLINN"===s,l="PHONG"===s,h="LAMBERT"===s,f=u.diffuse;f&&(c||l||h)&&(Vt(f)||n.color.set(f));var d=u.transparency;null!=d&&(n.opacity=d);var p=u.transparent;null!=p&&(n.opacity=p)}}var v=t.pbrMetallicRoughness;if(v){var m=v.baseColorFactor;m&&(n.color[0]=m[0],n.color[1]=m[1],n.color[2]=m[2],n.opacity=m[3]);var y=v.metallicFactor;null!=y&&(n.metallic=y);var g=v.roughnessFactor;null!=g&&(n.roughness=g)}return n}function Kt(e,t){var r=t.mesh;if(r&&(r.instances=r.instances?r.instances+1:1),t.children)for(var n=t.children,i=0,o=n.length;i<o;i++){var a=n[i];a?Kt(e,a):e.error("Node not found: "+i)}}var qt=[];function Zt(e,t,r,n){var i,o=e.xktModel;if(t.matrix&&(i=t.matrix,n=n?k.mulMat4(n,i,k.mat4()):i),t.translation&&(i=k.translationMat4v(t.translation),n=n?k.mulMat4(n,i,k.mat4()):i),t.rotation&&(i=k.quaternionToMat4(t.rotation),n=n?k.mulMat4(n,i,k.mat4()):i),t.scale&&(i=k.scalingMat4v(t.scale),n=n?k.mulMat4(n,i,k.mat4()):i),t.mesh){var a=t.mesh,s=a.primitives.length;if(s>0)for(var u=0;u<s;u++){var c=a.primitives[u];if(!c._xktGeometryId){var l="geometry-"+e.nextId++,h={geometryId:l};switch(c.mode){case 0:h.primitiveType="points";break;case 1:case 2:case 3:h.primitiveType="lines";break;default:h.primitiveType="triangles"}if(!c.attributes.POSITION)continue;h.positions=c.attributes.POSITION.value,e.stats.numVertices+=h.positions.length/3,e.includeNormals&&c.attributes.NORMAL&&(h.normals=c.attributes.NORMAL.value,e.stats.numNormals+=h.normals.length/3),c.attributes.COLOR_0&&(h.colorsCompressed=c.attributes.COLOR_0.value),e.includeTextures&&c.attributes.TEXCOORD_0&&(h.uvs=c.attributes.TEXCOORD_0.value,e.stats.numUVs+=h.uvs.length/2),c.indices&&(h.indices=c.indices.value,4===c.mode&&(e.stats.numTriangles+=h.indices.length/3)),o.createGeometry(h),c._xktGeometryId=l,e.stats.numGeometries++}var f=e.nextId++,d={meshId:f,geometryId:c._xktGeometryId,matrix:n?n.slice():k.identityMat4()},p=c.material;p?(d.textureSetId=p._textureSetId,d.color=p._attributes.color,d.opacity=p._attributes.opacity,d.metallic=p._attributes.metallic,d.roughness=p._attributes.roughness):(d.color=[1,1,1],d.opacity=1),o.createMesh(d),qt.push(f)}}if(t.children)for(var v=t.children,m=0,y=v.length;m<y;m++)Zt(e,v[m],r+1,n);var g=t.name;if((null!=g||0===r)&&qt.length>0){null==g&&e.log("Warning: 'name' properties not found on glTF scene nodes - will randomly-generate object IDs in XKT");var x=g;if(null==x)for(o.entities[x]&&e.log("Warning: Two or more glTF nodes found with same 'name' attribute: '".concat(g," - will randomly-generating an object ID in XKT"));!x||o.entities[x];)x="entity-"+e.nextId++;if(e.metaModelCorrections){var w=e.metaModelCorrections.eachChildRoot[x];if(w){var b=e.metaModelCorrections.eachRootStats[w.id];b.countChildren++,b.countChildren>=b.numChildren&&(o.createEntity({entityId:w.id,meshIds:qt}),e.stats.numObjects++,qt.length=0)}else e.metaModelCorrections.metaObjectsMap[x]&&(o.createEntity({entityId:x,meshIds:qt}),e.stats.numObjects++,qt.length=0)}else o.createEntity({entityId:x,meshIds:qt}),e.stats.numObjects++,qt.length=0}}var Yt="undefined"!=typeof atob?atob:function(e){return Buffer.from(e,"base64").toString("binary")},Qt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Wt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Jt(e){var t=e.data,r=e.xktModel,n=e.metaModelData,i=e.includeNormals,o=e.reuseGeometries,a=e.getAttachment,s=e.stats,u=void 0===s?{}:s,c=e.log;return c&&c("Using parser: parseGLTFJSONIntoXKTModel"),new Promise((function(e,s){if(t)if(r){u.sourceFormat="glTF",u.schemaVersion="2.0",u.title="",u.author="",u.created="",u.numTriangles=0,u.numVertices=0,u.numNormals=0,u.numObjects=0,u.numGeometries=0;var l={gltf:t,metaModelCorrections:n?Ht(n):null,getAttachment:a||function(){throw new Error("You must define getAttachment() method to convert glTF with external resources")},log:c||function(e){},xktModel:r,includeNormals:i,createXKTGeometryIds:{},nextMeshId:0,reuseGeometries:!1!==o,stats:u};l.log("Parsing normals: ".concat(l.includeNormals?"enabled":"disabled")),function(e){var t=e.gltf.buffers;return t?Promise.all(t.map((function(t){return function(e,t){return new Promise((function(r,n){if(t._arrayBuffer)return t._buffer=t._arrayBuffer,void r(t);var i=t.uri;i?function(e,t){return new Promise((function(r,n){var i=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){var o=!!i[2],a=i[3];a=decodeURIComponent(a),o&&(a=Yt(a));for(var s=new ArrayBuffer(a.length),u=new Uint8Array(s),c=0;c<a.length;c++)u[c]=a.charCodeAt(c);r(s)}else e.getAttachment(t).then((function(e){r(e)}),(function(e){n(e)}))}))}(e,i).then((function(e){t._buffer=e,r(e)}),(function(e){n(e)})):n("gltf/handleBuffer missing uri in "+JSON.stringify(t))}))}(e,t)}))):new Promise((function(e,t){e()}))}(l).then((function(){!function(e){var t=e.gltf.bufferViews;if(t)for(var r=0,n=t.length;r<n;r++)$t(e,t[r])}(l),function(e){var t=e.gltf.buffers;if(t)for(var r=0,n=t.length;r<n;r++)t[r]._buffer=null}(l),function(e){var t=e.gltf.materials;if(t)for(var r=0,n=t.length;r<n;r++){var i=t[r],o=er(0,i);i._materialData=o}}(l),function(e){var t=e.gltf.scene||0,r=e.gltf.scenes[t];if(!r)throw new Error("glTF has no default scene");!function(e,t){var r=t.nodes;if(r)for(var n=0,i=r.length;n<i;n++){var o=e.gltf.nodes[r[n]];o&&rr(e,o,0,null)}}(e,r)}(l),e()}),(function(e){s(e)}))}else s("Argument expected: xktModel");else s("Argument expected: data")}))}function Ht(e){for(var t={},r={},n=e.metaObjects||[],i={},o=0,a=n.length;o<a;o++){var s=n[o];i[s.id]=s}for(var u=0,c=n.length;u<c;u++){var l=n[u];if(void 0!==l.parent&&null!==l.parent){var h=i[l.parent];if(l.type===h.type){for(var f=h;f.parent&&i[f.parent].type===f.type;)f=i[f.parent];(t[f.id]||(t[f.id]={numChildren:0,countChildren:0})).numChildren++,r[l.id]=f}}}return{metaObjectsMap:i,eachRootStats:t,eachChildRoot:r}}function $t(e,t){var r=e.gltf.buffers[t.buffer];t._typedArray=null;var n=t.byteLength||0,i=t.byteOffset||0;t._buffer=r._buffer.slice(i,i+n)}function er(e,t){var r={color:new Float32Array([1,1,1]),opacity:1,metallic:0,roughness:1},n=t.extensions;if(n){var i=n.KHR_materials_pbrSpecularGlossiness;if(i){var o=i.diffuseFactor;null!=o&&(r.color[0]=o[0],r.color[1]=o[1],r.color[2]=o[2])}var a=n.KHR_materials_common;if(a){var s=a.technique,u=a.values||{},c="BLINN"===s,l="PHONG"===s,h="LAMBERT"===s,f=u.diffuse;f&&(c||l||h)&&(Vt(f)||(r.color[0]=f[0],r.color[1]=f[1],r.color[2]=f[2]));var d=u.transparency;null!=d&&(r.opacity=d);var p=u.transparent;null!=p&&(r.opacity=p)}}var v=t.pbrMetallicRoughness;if(v){var m=v.baseColorFactor;m&&(r.color[0]=m[0],r.color[1]=m[1],r.color[2]=m[2],r.opacity=m[3]);var y=v.metallicFactor;null!=y&&(r.metallic=y);var g=v.roughnessFactor;null!=g&&(r.roughness=g)}return r}var tr=[];function rr(e,t,r,n){var i,o=e.gltf,a=e.xktModel;t.matrix&&(i=t.matrix,n=n?k.mulMat4(n,i,k.mat4()):i),t.translation&&(i=k.translationMat4v(t.translation),n=n?k.mulMat4(n,i,i):i),t.rotation&&(i=k.quaternionToMat4(t.rotation),n=n?k.mulMat4(n,i,i):i),t.scale&&(i=k.scalingMat4v(t.scale),n=n?k.mulMat4(n,i,i):i);var s=t.mesh;if(void 0!==s){var u=o.meshes[s];if(u){var c=u.primitives.length;if(c>0)for(var l=0;l<c;l++){var h=u.primitives[l],f=nr(h),d=e.createXKTGeometryIds[f];if(!e.reuseGeometries||!d){d="geometry-"+e.nextMeshId++;var p={};ir(e,h,p);var v=p.colors,m=void 0;if(p.colors){m=[];for(var y=0,g=v.length;y<g;y+=4)m.push(v[y+0]),m.push(v[y+1]),m.push(v[y+2]),m.push(255)}a.createGeometry({geometryId:d,primitiveType:p.primitive,positions:p.positions,normals:e.includeNormals?p.normals:null,colorsCompressed:m,indices:p.indices}),e.stats.numGeometries++,e.stats.numVertices+=p.positions?p.positions.length/3:0,e.stats.numNormals+=e.includeNormals&&p.normals?p.normals.length/3:0,e.stats.numTriangles+=p.indices?p.indices.length/3:0,e.createXKTGeometryIds[f]=d}var x=h.material,w=null!=x?o.materials[x]:null,b=w?w._materialData.color:new Float32Array([1,1,1,1]),M=w?w._materialData.opacity:1,I=w?w._materialData.metallic:0,T=w?w._materialData.roughness:1,A="mesh-"+e.nextMeshId++;a.createMesh({meshId:A,geometryId:d,matrix:n?n.slice():k.identityMat4(),color:b,opacity:M,metallic:I,roughness:T}),tr.push(A)}}}if(t.children)for(var S=t.children,O=0,L=S.length;O<L;O++){var P=S[O],E=o.nodes[P];E?rr(e,E,r+1,n):console.warn("Node not found: "+O)}var j=t.name;if((null!=j||0===r)&&tr.length>0){null==j&&e.log("[parseGLTFJSONIntoXKTModel] Warning: 'name' properties not found on glTF scene nodes - will randomly-generate object IDs in XKT");var G=j;if(null==G)for(a.entities[G]&&e.error("Two or more glTF nodes found with same 'name' attribute: '"+j+"'");!G||a.entities[G];)G="entity-"+e.nextId++;if(e.metaModelCorrections){var _=e.metaModelCorrections.eachChildRoot[G];if(_){var D=e.metaModelCorrections.eachRootStats[_.id];D.countChildren++,D.countChildren>=D.numChildren&&(a.createEntity({entityId:_.id,meshIds:tr}),e.stats.numObjects++,tr=[])}else e.metaModelCorrections.metaObjectsMap[G]&&(a.createEntity({entityId:G,meshIds:tr}),e.stats.numObjects++,tr=[])}else a.createEntity({entityId:G,meshIds:tr}),e.stats.numObjects++,tr=[]}}function nr(e){if(!e.attributes)return"empty";var t=e.mode,r=(e.material,e.indices),n=e.attributes.POSITION,i=e.attributes.NORMAL,o=e.attributes.COLOR_0,a=e.attributes.TEXCOORD_0;return[t,null!=r?r:"-",null!=n?n:"-",null!=i?i:"-",null!=o?o:"-",null!=a?a:"-"].join(";")}function ir(e,t,r){var n=t.attributes;if(n){switch(t.mode){case 0:r.primitive="points";break;case 1:case 2:case 3:r.primitive="lines";break;case 4:default:r.primitive="triangles";break;case 5:console.log("TRIANGLE_STRIP"),r.primitive="triangles";break;case 6:console.log("TRIANGLE_FAN"),r.primitive="triangles"}var i=e.gltf.accessors,o=t.indices;if(null!=o){var a=i[o];r.indices=or(e,a)}var s=n.POSITION;if(null!=s){var u=i[s];r.positions=or(e,u)}var c=n.NORMAL;if(null!=c){var l=i[c];r.normals=or(e,l)}var h=n.COLOR_0;if(null!=h){var f=i[h];r.colors=or(e,f)}}}function or(e,t){var r=e.gltf.bufferViews[t.bufferView],n=Wt[t.type],i=Qt[t.componentType],o=i.BYTES_PER_ELEMENT*n;if(t.byteStride&&t.byteStride!==o)throw new Error("interleaved buffer!");return new i(r._buffer,t.byteOffset||0,t.count*n)}function ar(e){var t=e.WebIFC,r=e.data,n=e.xktModel,i=e.autoNormals,o=void 0===i||i,a=e.includeTypes,s=e.excludeTypes,u=e.wasmPath,c=e.stats,l=void 0===c?{}:c,h=e.log;return h&&h("Using parser: parseIFCIntoXKTModel"),new Promise((function(e,i){if(r)if(n)if(u){var c=new t.IfcAPI;u&&c.SetWasmPath(u),c.Init().then((function(){var i=new Uint8Array(r),u=c.OpenModel(i);l.sourceFormat="IFC",l.schemaVersion="",l.title="",l.author="",l.created="",l.numMetaObjects=0,l.numPropertySets=0,l.numObjects=0,l.numGeometries=0,l.numTriangles=0,l.numVertices=0;var f={WebIFC:t,modelID:u,ifcAPI:c,xktModel:n,autoNormals:o,log:h||function(e){},nextId:0,stats:l};if(a){f.includeTypes={};for(var d=0,p=a.length;d<p;d++)f.includeTypes[a[d]]=!0}if(s){f.excludeTypes={};for(var v=0,m=s.length;v<m;v++)f.excludeTypes[s[v]]=!0}var y=f.ifcAPI.GetLineIDsWithType(u,t.IFCPROJECT).get(0);f.ifcAPI.GetLine(u,y),f.xktModel.schema="",f.xktModel.modelId=""+u,f.xktModel.projectId=""+y,function(e){var t=e.ifcAPI.GetLineIDsWithType(e.modelID,e.WebIFC.IFCPROJECT).get(0),r=e.ifcAPI.GetLine(e.modelID,t);sr(e,r)}(f),function(e){for(var t=e.ifcAPI.LoadAllGeometry(e.modelID),r=0,n=t.size();r<n;r++)cr(e,t.get(r));for(var i=e.ifcAPI.GetLineIDsWithType(e.modelID,e.WebIFC.IFCSPACE),o=0,a=i.size();o<a;o++){var s=i.get(o),u=e.ifcAPI.GetFlatMesh(e.modelID,s);cr(e,u)}}(f),function(e){for(var t=e.ifcAPI.GetLineIDsWithType(e.modelID,e.WebIFC.IFCRELDEFINESBYPROPERTIES),r=0;r<t.size();r++){var n=t.get(r),i=e.ifcAPI.GetLine(e.modelID,n,!0);if(i){var o=i.RelatingPropertyDefinition;if(!o)continue;var a=o.GlobalId.value,s=i.RelatedObjects;if(s)for(var u=0,c=s.length;u<c;u++){var l=s[u].GlobalId.value,h=e.xktModel.metaObjects[l];h&&(h.propertySetIds||(h.propertySetIds=[]),h.propertySetIds.push(a))}var f=o.HasProperties;if(f&&f.length>0){for(var d=o.Name.value,p=[],v=0,m=f.length;v<m;v++){var y=f[v],g=y.Name,x=y.NominalValue;if(g&&x){var w={name:g.value,type:x.type,value:x.value,valueType:x.valueType};y.Description?w.description=y.Description.value:x.description&&(w.description=x.description),p.push(w)}}e.xktModel.createPropertySet({propertySetId:a,propertySetType:"Default",propertySetName:d,properties:p}),e.stats.numPropertySets++}}}}(f),e()})).catch((function(e){i(e)}))}else i("Argument expected: wasmPath");else i("Argument expected: xktModel");else i("Argument expected: data")}))}function sr(e,t,r){var n=t.__proto__.constructor.name;if((!e.includeTypes||e.includeTypes[n])&&(!e.excludeTypes||!e.excludeTypes[n])){!function(e,t,r){var n=t.GlobalId.value,i=t.__proto__.constructor.name,o=t.Name&&""!==t.Name.value?t.Name.value:i;e.xktModel.createMetaObject({metaObjectId:n,propertySetIds:null,metaObjectType:i,metaObjectName:o,parentMetaObjectId:r}),e.stats.numMetaObjects++}(e,t,r);var i=t.GlobalId.value;ur(e,t.expressID,"RelatingObject","RelatedObjects",e.WebIFC.IFCRELAGGREGATES,i),ur(e,t.expressID,"RelatingStructure","RelatedElements",e.WebIFC.IFCRELCONTAINEDINSPATIALSTRUCTURE,i)}}function ur(e,t,r,n,i,o){for(var a=e.ifcAPI.GetLineIDsWithType(e.modelID,i),s=0;s<a.size();s++){var u=a.get(s),c=e.ifcAPI.GetLine(e.modelID,u),l=c[r];if(Array.isArray(l)?l.map((function(e){return e.value})).includes(t):l.value===t){var h=c[n];if(Array.isArray(h))h.forEach((function(t){var r=e.ifcAPI.GetLine(e.modelID,t.value);sr(e,r,o)}));else{var f=e.ifcAPI.GetLine(e.modelID,h.value);sr(e,f,o)}}}}function cr(e,t){var r=t.expressID,n=t.geometries,i=[],o=e.ifcAPI.GetLine(e.modelID,r).GlobalId.value,a=o,s=e.xktModel.metaObjects[a];if(!e.includeTypes||s&&e.includeTypes[s.metaObjectType])if(!e.excludeTypes||s&&!e.excludeTypes[s.metaObjectType]){for(var u=0,c=n.size();u<c;u++){var l=n.get(u),h=""+l.geometryExpressID;if(!e.xktModel.geometries[h]){for(var f=e.ifcAPI.GetGeometry(e.modelID,l.geometryExpressID),d=e.ifcAPI.GetVertexArray(f.GetVertexData(),f.GetVertexDataSize()),p=e.ifcAPI.GetIndexArray(f.GetIndexData(),f.GetIndexDataSize()),v=[],m=[],y=0,g=d.length/6;y<g;y++)v.push(d[6*y+0]),v.push(d[6*y+1]),v.push(d[6*y+2]);if(!e.autoNormals)for(var x=0,w=d.length/6;x<w;x++)m.push(d[6*x+3]),m.push(d[6*x+4]),m.push(d[6*x+5]);e.xktModel.createGeometry({geometryId:h,primitiveType:"triangles",positions:v,normals:e.autoNormals?null:m,indices:p}),e.stats.numGeometries++,e.stats.numVertices+=v.length/3,e.stats.numTriangles+=p.length/3}var b="mesh"+e.nextId++;e.xktModel.createMesh({meshId:b,geometryId:h,matrix:new Float32Array(l.flatTransformation),color:[l.color.x,l.color.y,l.color.z],opacity:l.color.w}),i.push(b)}i.length>0&&(e.xktModel.createEntity({entityId:o,meshIds:i}),e.stats.numObjects++)}else console.log("excluding: "+a)}const lr=require("@loaders.gl/las");function hr(e){var t=e.data,r=e.xktModel,n=e.rotateX,i=void 0!==n&&n,o=e.colorDepth,a=void 0===o?8:o,s=e.skip,u=void 0===s?1:s,c=e.stats,l=e.log,h=void 0===l?function(){}:l;return h&&h("Using parser: parseLASIntoXKTModel"),new Promise((function(e,n){t?r?(h&&(h("Converting LAZ/LAS"),i&&h("Rotating model 90 degrees about X-axis")),(0,Ee.parse)(t,lr.LASLoader,{las:{colorDepth:a,skip:u}}).then((function(t){var n=t.attributes,o=t.loaderData,a=void 0!==o.pointsFormatId?o.pointsFormatId:-1;if(n.POSITION){var s,u;switch(a){case 0:if(!n.intensity)return void h("No intensities found in file (expected for LAS point format 0)");s=fr(n.POSITION,i),u=pr(n.intensity);break;case 1:if(!n.intensity)return void h("No intensities found in file (expected for LAS point format 1)");s=fr(n.POSITION,i),u=pr(n.intensity);break;case 2:if(!n.intensity)return void h("No intensities found in file (expected for LAS point format 2)");s=fr(n.POSITION,i),u=dr(n.COLOR_0,n.intensity);break;case 3:if(!n.intensity)return void h("No intensities found in file (expected for LAS point format 3)");s=fr(n.POSITION,i),u=dr(n.COLOR_0,n.intensity)}r.createGeometry({geometryId:"pointsGeometry",primitiveType:"points",positions:s,colorsCompressed:u}),r.createMesh({meshId:"pointsMesh",geometryId:"pointsGeometry"});var l=k.createUUID();r.createEntity({entityId:l,meshIds:["pointsMesh"]});var f=k.createUUID();r.createMetaObject({metaObjectId:f,metaObjectType:"Model",metaObjectName:"Model"}),r.createMetaObject({metaObjectId:l,metaObjectType:"PointCloud",metaObjectName:"PointCloud (LAZ)",parentMetaObjectId:f}),c&&(c.sourceFormat="LAS",c.schemaVersion="",c.title="",c.author="",c.created="",c.numMetaObjects=2,c.numPropertySets=0,c.numObjects=1,c.numGeometries=1,c.numVertices=s.length/3),e()}else h("No positions found in file (expected for all LAS point formats)")}),(function(e){n(e)}))):n("Argument expected: xktModel"):n("Argument expected: data")}))}function fr(e,t){var r=e.value;if(t&&r)for(var n=0,i=r.length;n<i;n+=3){var o=r[n+1];r[n+1]=r[n+2],r[n+2]=o}return r}function dr(e,t){for(var r=e.value,n=e.size,i=t.value,o=4*i.length,a=new Uint8Array(o),s=0,u=0,c=0,l=i.length;s<l;s++,c+=n,u+=4)a[u+0]=r[c+0],a[u+1]=r[c+1],a[u+2]=r[c+2],a[u+3]=Math.round(i[s]/65536*255);return a}function pr(e){for(var t=e.intensity,r=4*t.length,n=new Uint8Array(r),i=0,o=0,a=t.length;i<a;i++,o+=4)n[o+0]=0,n[o+1]=0,n[o+2]=0,n[o+3]=Math.round(t[i]/65536*255);return n}function vr(e){var t=e.metaModelData,r=e.xktModel,n=e.includeTypes,i=e.excludeTypes,o=e.log;return o&&o("Using parser: parseMetaModelIntoXKTModel"),new Promise((function(e,a){var s,u,c=t.metaObjects||[],l=t.propertySets||[];r.modelId=t.revisionId||"",r.projectId=t.projectId||"",r.revisionId=t.revisionId||"",r.author=t.author||"",r.createdAt=t.createdAt||"",r.creatingApplication=t.creatingApplication||"",r.schema=t.schema||"";for(var h=0,f=l.length;h<f;h++){var d=l[h];r.createPropertySet({propertySetId:d.id,propertySetName:d.name,propertySetType:d.type,properties:d.properties})}if(n){s={};for(var p=0,v=n.length;p<v;p++)s[n[p]]=!0}if(i){u={};for(var m=0,y=i.length;m<y;m++)u[i[m]]=!0}for(var g={},x=0,w=c.length;x<w;x++){var b=c[x];g[b.id]=b}for(var M=0,I=0,T=c.length;I<T;I++){var A=c[I],S=A.type;if((!u||!u[S])&&(!s||s[S])){if(void 0!==A.parent&&null!==A.parent){var O=g[A.parent];if(A.type===O.type)continue}var L=[];if(A.propertySetIds)for(var P=0,E=A.propertySetIds.length;P<E;P++){var j=A.propertySetIds[P];null!=j&&""!==j&&L.push(j)}void 0!==A.propertySetId&&null!==A.propertySetId&&""!==A.propertySetId&&L.push(A.propertySetId),r.createMetaObject({metaObjectId:A.id,metaObjectType:A.type,metaObjectName:A.name,parentMetaObjectId:A.parent,propertySetIds:L.length>0?L:null}),M++}}o&&o("Converted meta objects: "+M),e()}))}function mr(e){var t=e.data,r=e.xktModel,n=e.littleEndian,i=void 0===n||n,o=e.stats,a=e.log;return a&&a("Using parser: parsePCDIntoXKTModel"),new Promise((function(e,n){var s=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}(new Uint8Array(t)),u=function(e){var t={},r=e.search(/[\r\n]DATA\s(\S*)\s/i),n=/[\r\n]DATA\s(\S*)\s/i.exec(e.substr(r-1));if(t.data=n[1],t.headerLen=n[0].length+r,t.str=e.substr(0,t.headerLen),t.str=t.str.replace(/\#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),t.fields=/FIELDS (.*)/i.exec(t.str),t.size=/SIZE (.*)/i.exec(t.str),t.type=/TYPE (.*)/i.exec(t.str),t.count=/COUNT (.*)/i.exec(t.str),t.width=/WIDTH (.*)/i.exec(t.str),t.height=/HEIGHT (.*)/i.exec(t.str),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),t.points=/POINTS (.*)/i.exec(t.str),null!==t.version&&(t.version=parseFloat(t.version[1])),null!==t.fields&&(t.fields=t.fields[1].split(" ")),null!==t.type&&(t.type=t.type[1].split(" ")),null!==t.width&&(t.width=parseInt(t.width[1])),null!==t.height&&(t.height=parseInt(t.height[1])),null!==t.viewpoint&&(t.viewpoint=t.viewpoint[1]),null!==t.points&&(t.points=parseInt(t.points[1],10)),null===t.points&&(t.points=t.width*t.height),null!==t.size&&(t.size=t.size[1].split(" ").map((function(e){return parseInt(e,10)}))),null!==t.count)t.count=t.count[1].split(" ").map((function(e){return parseInt(e,10)}));else{t.count=[];for(var i=0,o=t.fields.length;i<o;i++)t.count.push(1)}t.offset={};for(var a=0,s=0,u=t.fields.length;s<u;s++)"ascii"===t.data?t.offset[t.fields[s]]=s:(t.offset[t.fields[s]]=a,a+=t.size[s]*t.count[s]);return t.rowSize=a,t}(s),c=[],l=[];if("ascii"===u.data)for(var h=u.offset,f=s.substr(u.headerLen).split("\n"),d=0,p=f.length;d<p;d++)if(""!==f[d]){var v=f[d].split(" ");if(void 0!==h.x&&(c.push(parseFloat(v[h.x])),c.push(parseFloat(v[h.y])),c.push(parseFloat(v[h.z]))),void 0!==h.rgb){var m=parseFloat(v[h.rgb]),y=m>>16&255,g=m>>8&255,x=m>>0&255;l.push(y,g,x,255)}else l.push(255),l.push(255),l.push(255)}if("binary_compressed"===u.data)for(var w=new Uint32Array(t.slice(u.headerLen,u.headerLen+8)),b=w[0],M=w[1],I=function(e,t){var r,n,i,o=e.length,a=new Uint8Array(t),s=0,u=0;do{if((r=e[s++])<32){if(u+ ++r>t)throw new Error("Output buffer is not large enough");if(s+r>o)throw new Error("Invalid compressed data");do{a[u++]=e[s++]}while(--r)}else{if(n=r>>5,i=u-((31&r)<<8)-1,s>=o)throw new Error("Invalid compressed data");if(7===n&&(n+=e[s++],s>=o))throw new Error("Invalid compressed data");if(i-=e[s++],u+n+2>t)throw new Error("Output buffer is not large enough");if(i<0)throw new Error("Invalid compressed data");if(i>=u)throw new Error("Invalid compressed data");do{a[u++]=a[i++]}while(2+--n)}}while(s<o);return a}(new Uint8Array(t,u.headerLen+8,b),M),T=new DataView(I.buffer),A=u.offset,S=0;S<u.points;S++)void 0!==A.x&&(c.push(T.getFloat32(u.points*A.x+u.size[0]*S,i)),c.push(T.getFloat32(u.points*A.y+u.size[1]*S,i)),c.push(T.getFloat32(u.points*A.z+u.size[2]*S,i))),void 0!==A.rgb?(l.push(T.getUint8(u.points*A.rgb+u.size[3]*S+0)),l.push(T.getUint8(u.points*A.rgb+u.size[3]*S+1)),l.push(T.getUint8(u.points*A.rgb+u.size[3]*S+2))):(l.push(1),l.push(1),l.push(1));if("binary"===u.data)for(var O=new DataView(t,u.headerLen),L=u.offset,P=0,E=0;P<u.points;P++,E+=u.rowSize)void 0!==L.x&&(c.push(O.getFloat32(E+L.x,i)),c.push(O.getFloat32(E+L.y,i)),c.push(O.getFloat32(E+L.z,i))),void 0!==L.rgb?(l.push(O.getUint8(E+L.rgb+2)),l.push(O.getUint8(E+L.rgb+1)),l.push(O.getUint8(E+L.rgb+0))):(l.push(255),l.push(255),l.push(255));r.createGeometry({geometryId:"pointsGeometry",primitiveType:"points",positions:c,colors:l&&l.length>0?l:null}),r.createMesh({meshId:"pointsMesh",geometryId:"pointsGeometry"}),r.createEntity({entityId:"geometries",meshIds:["pointsMesh"]}),a&&(a("Converted drawable objects: 1"),a("Converted geometries: 1"),a("Converted vertices: "+c.length/3)),o&&(o.sourceFormat="PCD",o.schemaVersion="",o.title="",o.author="",o.created="",o.numObjects=1,o.numGeometries=1,o.numVertices=c.length/3),e()}))}const yr=require("@loaders.gl/ply");function gr(e){return gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gr(e)}function xr(){xr=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof h?t:h,o=Object.create(i.prototype),a=new I(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function h(){}function f(){}function d(){}var p={};s(p,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(T([])));m&&m!==t&&r.call(m,i)&&(p=m);var y=d.prototype=h.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(i,o,a,s){var u=c(e[i],e,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==gr(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=d,s(y,"constructor",d),s(d,"constructor",f),f.displayName=s(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},g(x.prototype),s(x.prototype,o,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new x(u(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(y),s(y,a,"Generator"),s(y,i,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;M(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function wr(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function br(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){wr(o,n,i,a,s,"next",e)}function s(e){wr(o,n,i,a,s,"throw",e)}a(void 0)}))}}function Mr(e){return Ir.apply(this,arguments)}function Ir(){return(Ir=br(xr().mark((function e(t){var r,n,i,o,a,s,u,c,l,h,f;return xr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data,n=t.xktModel,i=t.stats,(o=t.log)&&o("Using parser: parsePLYIntoXKTModel"),r){e.next=4;break}throw"Argument expected: data";case 4:if(n){e.next=6;break}throw"Argument expected: xktModel";case 6:return e.prev=6,e.next=9,(0,Ee.parse)(r,yr.PLYLoader);case 9:a=e.sent,e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(6),o&&o("Error: "+e.t0),e.abrupt("return");case 16:if(s=a.attributes,u=!!s.COLOR_0){for(c=u?s.COLOR_0.value:null,l=[],h=0,f=c.length;h<f;h+=4)l.push(c[h]),l.push(c[h+1]),l.push(c[h+2]);n.createGeometry({geometryId:"plyGeometry",primitiveType:"triangles",positions:s.POSITION.value,indices:a.indices?a.indices.value:[],colorsCompressed:l})}else n.createGeometry({geometryId:"plyGeometry",primitiveType:"triangles",positions:s.POSITION.value,indices:a.indices?a.indices.value:[]});n.createMesh({meshId:"plyMesh",geometryId:"plyGeometry",color:u?null:[1,1,1]}),n.createEntity({entityId:"ply",meshIds:["plyMesh"]}),i&&(i.sourceFormat="PLY",i.schemaVersion="",i.title="",i.author="",i.created="",i.numMetaObjects=2,i.numPropertySets=0,i.numObjects=1,i.numGeometries=1,i.numVertices=s.POSITION.value.length/3);case 22:case"end":return e.stop()}}),e,null,[[6,12]])})))).apply(this,arguments)}function Tr(e){return Tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tr(e)}function Ar(){Ar=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof h?t:h,o=Object.create(i.prototype),a=new I(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function h(){}function f(){}function d(){}var p={};s(p,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(T([])));m&&m!==t&&r.call(m,i)&&(p=m);var y=d.prototype=h.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(i,o,a,s){var u=c(e[i],e,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==Tr(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=d,s(y,"constructor",d),s(d,"constructor",f),f.displayName=s(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},g(x.prototype),s(x.prototype,o,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new x(u(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(y),s(y,a,"Generator"),s(y,i,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;M(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function Sr(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function Or(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){Sr(o,n,i,a,s,"next",e)}function s(e){Sr(o,n,i,a,s,"throw",e)}a(void 0)}))}}function Lr(e){return Pr.apply(this,arguments)}function Pr(){return(Pr=Or(Ar().mark((function e(t){var r,n,i,o,a,s,u,c;return Ar().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,n=t.splitMeshes,i=t.autoNormals,o=t.smoothNormals,a=t.smoothNormalsAngleThreshold,s=t.xktModel,u=t.stats,(c=t.log)&&c("Using parser: parseSTLIntoXKTModel"),e.abrupt("return",new Promise((function(e,t){if(r)if(s){var l=k.createUUID(),h=s.createMetaObject({metaObjectId:l,metaObjectType:"Model",metaObjectName:"Model"}),f={data:r,splitMeshes:n,autoNormals:i,smoothNormals:o,smoothNormalsAngleThreshold:a,xktModel:s,rootMetaObject:h,nextId:0,log:c||function(e){},stats:{numObjects:0,numGeometries:0,numTriangles:0,numVertices:0}},d=Fr(r);Er(d)?jr(f,d):Gr(f,Dr(r)),u&&(u.sourceFormat="STL",u.schemaVersion="",u.title="",u.author="",u.created="",u.numMetaObjects=2,u.numPropertySets=0,u.numObjects=1,u.numGeometries=1,u.numTriangles=f.stats.numTriangles,u.numVertices=f.stats.numVertices),e()}else t("Argument expected: xktModel");else t("Argument expected: data")})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Er(e){var t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;for(var r=[115,111,108,105,100],n=0;n<5;n++)if(r[n]!==t.getUint8(n,!1))return!0;return!1}function jr(e,t){for(var r,n,i,o,a,s,u,c=new DataView(t),l=c.getUint32(80,!0),h=!1,f=null,d=null,p=null,v=!1,m=0;m<70;m++)1129270351===c.getUint32(m,!1)&&82===c.getUint8(m+4)&&61===c.getUint8(m+5)&&(h=!0,o=[],a=c.getUint8(m+6)/255,s=c.getUint8(m+7)/255,u=c.getUint8(m+8)/255,c.getUint8(m+9));for(var y=[],g=[],x=e.splitMeshes,w=0;w<l;w++){var b=84+50*w,M=c.getFloat32(b,!0),I=c.getFloat32(b+4,!0),T=c.getFloat32(b+8,!0);if(h){var A=c.getUint16(b+48,!0);0==(32768&A)?(r=(31&A)/31,n=(A>>5&31)/31,i=(A>>10&31)/31):(r=a,n=s,i=u),(x&&r!==f||n!==d||i!==p)&&(null!==f&&(v=!0),f=r,d=n,p=i)}for(var S=1;S<=3;S++){var O=b+12*S;y.push(c.getFloat32(O,!0)),y.push(c.getFloat32(O+4,!0)),y.push(c.getFloat32(O+8,!0)),e.autoNormals||g.push(M,I,T),h&&o.push(r,n,i,1)}x&&v&&(kr(e,y,g,o),y=[],g=[],o=o?[]:null,v=!1)}y.length>0&&kr(e,y,g,o)}function Gr(e,t){for(var r,n,i,o,a,s,u,c=/facet([\s\S]*?)endfacet/g,l=0,h=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,f=new RegExp("vertex"+h+h+h,"g"),d=new RegExp("normal"+h+h+h,"g"),p=[],v=[];null!==(o=c.exec(t));){for(a=0,s=0,u=o[0];null!==(o=d.exec(u));)r=parseFloat(o[1]),n=parseFloat(o[2]),i=parseFloat(o[3]),s++;for(;null!==(o=f.exec(u));)p.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3])),v.push(r,n,i),a++;if(1!==s)return e.log("Error in normal of face "+l),-1;if(3!==a)return e.log("Error in positions of face "+l),-1;l++}kr(e,p,v,null)}var _r=0;function kr(e,t,r,n){for(var i=new Int32Array(t.length/3),o=0,a=i.length;o<a;o++)i[o]=o;r=r&&r.length>0?r:null,n=n&&n.length>0?n:null,!e.autoNormals&&e.smoothNormals&&function(e,t){var r,n,i,o,a,s,u,c,l,h,f,d=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).smoothNormalsAngleThreshold||20,p={},v=[],m={},y=4,g=Math.pow(10,y);for(u=0,l=e.length;u<l;u+=3){s=u/3,n=e[u],i=e[u+1],o=e[u+2],void 0===p[a="".concat(Math.round(n*g),"_").concat(Math.round(i*g),"_").concat(Math.round(o*g))]?p[a]=[s]:p[a].push(s);var x=k.normalizeVec3([t[u],t[u+1],t[u+2]]);v[s]=x,r=k.vec4([x[0],x[1],x[2],1]),m[s]=r}for(a in p)if(p.hasOwnProperty(a)){var w=p[a],b=w.length;for(u=0;u<b;u++){var M=w[u];for(r=m[M],c=0;c<b;c++)if(u!==c){var I=w[c];h=v[M],f=v[I],Math.abs(k.angleVec3(h,f)/k.DEGTORAD)<d&&(r[0]+=f[0],r[1]+=f[1],r[2]+=f[2],r[3]+=1)}}}for(u=0,l=t.length;u<l;u+=3)r=m[u/3],t[u+0]=r[0]/r[3],t[u+1]=r[1]/r[3],t[u+2]=r[2]/r[3]}(t,r,{smoothNormalsAngleThreshold:e.smoothNormalsAngleThreshold});var s=""+_r++,u=""+_r++,c=""+_r++;e.xktModel.createGeometry({geometryId:s,primitiveType:"triangles",positions:t,normals:e.autoNormals?null:r,colors:n,indices:i}),e.xktModel.createMesh({meshId:u,geometryId:s,color:n?null:[1,1,1],metallic:.9,roughness:.1}),e.xktModel.createEntity({entityId:c,meshIds:[u]}),e.xktModel.createMetaObject({metaObjectId:c,metaObjectType:"Default",metaObjectName:"STL Mesh",parentMetaObjectId:e.rootMetaObject.metaObjectId}),e.stats.numGeometries++,e.stats.numObjects++,e.stats.numVertices+=t.length/3,e.stats.numTriangles+=i.length/3}function Dr(e){return"string"!=typeof e?function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);return decodeURIComponent(escape(t))}(new Uint8Array(e)):e}function Fr(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}function Nr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var r=e.ySize||1;r<0&&(console.error("negative ySize not allowed - will invert"),r*=-1);var n=e.zSize||1;n<0&&(console.error("negative zSize not allowed - will invert"),n*=-1);var i=e.center,o=i?i[0]:0,a=i?i[1]:0,s=i?i[2]:0,u=-t+o,c=-r+a,l=-n+s,h=t+o,f=r+a,d=n+s;return{primitiveType:"triangles",positions:[h,f,d,u,f,d,u,c,d,h,c,d,h,f,d,h,c,d,h,c,l,h,f,l,h,f,d,h,f,l,u,f,l,u,f,d,u,f,d,u,f,l,u,c,l,u,c,d,u,c,l,h,c,l,h,c,d,u,c,d,h,c,l,u,c,l,u,f,l,h,f,l],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}function Vr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var r=e.ySize||1;r<0&&(console.error("negative ySize not allowed - will invert"),r*=-1);var n=e.zSize||1;n<0&&(console.error("negative zSize not allowed - will invert"),n*=-1);var i=e.center,o=i?i[0]:0,a=i?i[1]:0,s=i?i[2]:0,u=-t+o,c=-r+a,l=-n+s,h=t+o,f=r+a,d=n+s;return{primitiveType:"lines",positions:[u,c,l,u,c,d,u,f,l,u,f,d,h,c,l,h,c,d,h,f,l,h,f,d],indices:[0,1,1,3,3,2,2,0,4,5,5,7,7,6,6,4,0,4,1,5,2,6,3,7]}}function Cr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.radiusTop||1;t<0&&(console.error("negative radiusTop not allowed - will invert"),t*=-1);var r=e.radiusBottom||1;r<0&&(console.error("negative radiusBottom not allowed - will invert"),r*=-1);var n=e.height||1;n<0&&(console.error("negative height not allowed - will invert"),n*=-1);var i=e.radialSegments||32;i<0&&(console.error("negative radialSegments not allowed - will invert"),i*=-1),i<3&&(i=3);var o=e.heightSegments||1;o<0&&(console.error("negative heightSegments not allowed - will invert"),o*=-1),o<1&&(o=1);var a,s,u,c,l,h,f,d,p,v,m,y=!!e.openEnded,g=e.center,x=g?g[0]:0,w=g?g[1]:0,b=g?g[2]:0,M=n/2,I=n/o,T=2*Math.PI/i,A=1/i,S=(t-r)/o,O=[],L=[],P=[],E=[],j=(90-180*Math.atan(n/(r-t))/Math.PI)/90;for(a=0;a<=o;a++)for(l=t-a*S,h=M-a*I,s=0;s<=i;s++)u=Math.sin(s*T),c=Math.cos(s*T),L.push(l*u),L.push(j),L.push(l*c),P.push(s*A),P.push(1*a/o),O.push(l*u+x),O.push(h+w),O.push(l*c+b);for(a=0;a<o;a++)for(s=0;s<=i;s++)d=(f=a*(i+1)+s)+i,E.push(f),E.push(d),E.push(d+1),E.push(f),E.push(d+1),E.push(f+1);if(!y&&t>0){for(p=O.length/3,L.push(0),L.push(1),L.push(0),P.push(.5),P.push(.5),O.push(0+x),O.push(M+w),O.push(0+b),s=0;s<=i;s++)u=Math.sin(s*T),c=Math.cos(s*T),v=.5*Math.sin(s*T)+.5,m=.5*Math.cos(s*T)+.5,L.push(t*u),L.push(1),L.push(t*c),P.push(v),P.push(m),O.push(t*u+x),O.push(M+w),O.push(t*c+b);for(s=0;s<i;s++)g=p,f=p+1+s,E.push(f),E.push(f+1),E.push(g)}if(!y&&r>0){for(p=O.length/3,L.push(0),L.push(-1),L.push(0),P.push(.5),P.push(.5),O.push(0+x),O.push(0-M+w),O.push(0+b),s=0;s<=i;s++)u=Math.sin(s*T),c=Math.cos(s*T),v=.5*Math.sin(s*T)+.5,m=.5*Math.cos(s*T)+.5,L.push(r*u),L.push(-1),L.push(r*c),P.push(v),P.push(m),O.push(r*u+x),O.push(0-M+w),O.push(r*c+b);for(s=0;s<i;s++)g=p,f=p+1+s,E.push(g),E.push(f+1),E.push(f)}return{primitiveType:"triangles",positions:O,normals:L,uv:P,uvs:P,indices:E}}function Br(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.size||1;t<0&&(console.error("negative size not allowed - will invert"),t*=-1);var r=e.divisions||1;r<0&&(console.error("negative divisions not allowed - will invert"),r*=-1),r<1&&(r=1);for(var n=(t=t||10)/(r=r||10),i=t/2,o=[],a=[],s=0,u=0,c=-i;u<=r;u++,c+=n)o.push(-i),o.push(0),o.push(c),o.push(i),o.push(0),o.push(c),o.push(c),o.push(0),o.push(-i),o.push(c),o.push(0),o.push(i),a.push(s++),a.push(s++),a.push(s++),a.push(s++);return{primitiveType:"lines",positions:o,indices:a}}function Ur(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var r=e.zSize||1;r<0&&(console.error("negative zSize not allowed - will invert"),r*=-1);var n=e.xSegments||1;n<0&&(console.error("negative xSegments not allowed - will invert"),n*=-1),n<1&&(n=1);var i=e.xSegments||1;i<0&&(console.error("negative zSegments not allowed - will invert"),i*=-1),i<1&&(i=1);var o,a,s,u,c,l,h,f=e.center,d=f?f[0]:0,p=f?f[1]:0,v=f?f[2]:0,m=t/2,y=r/2,g=Math.floor(n)||1,x=Math.floor(i)||1,w=g+1,b=x+1,M=t/g,I=r/x,T=new Float32Array(w*b*3),A=new Float32Array(w*b*3),S=new Float32Array(w*b*2),O=0,L=0;for(o=0;o<b;o++){var P=o*I-y;for(a=0;a<w;a++)s=a*M-m,T[O]=s+d,T[O+1]=p,T[O+2]=-P+v,A[O+2]=-1,S[L]=a/g,S[L+1]=(x-o)/x,O+=3,L+=2}O=0;var E=new(T.length/3>65535?Uint32Array:Uint16Array)(g*x*6);for(o=0;o<x;o++)for(a=0;a<g;a++)u=a+w*o,c=a+w*(o+1),l=a+1+w*(o+1),h=a+1+w*o,E[O]=h,E[O+1]=c,E[O+2]=u,E[O+3]=h,E[O+4]=l,E[O+5]=c,O+=6;return{primitiveType:"triangles",positions:T,normals:A,uv:S,uvs:S,indices:E}}function zr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lod||1,r=e.center?e.center[0]:0,n=e.center?e.center[1]:0,i=e.center?e.center[2]:0,o=e.radius||1;o<0&&(console.error("negative radius not allowed - will invert"),o*=-1);var a=e.heightSegments||18;a<0&&(console.error("negative heightSegments not allowed - will invert"),a*=-1),(a=Math.floor(t*a))<18&&(a=18);var s=e.widthSegments||18;s<0&&(console.error("negative widthSegments not allowed - will invert"),s*=-1),(s=Math.floor(t*s))<18&&(s=18);var u,c,l,h,f,d,p,v,m,y,g,x,w,b,M=[],I=[],T=[],A=[];for(u=0;u<=a;u++)for(l=u*Math.PI/a,h=Math.sin(l),f=Math.cos(l),c=0;c<=s;c++)d=2*c*Math.PI/s,p=Math.sin(d),v=Math.cos(d)*h,m=f,y=p*h,g=1-c/s,x=u/a,I.push(v),I.push(m),I.push(y),T.push(g),T.push(x),M.push(r+o*v),M.push(n+o*m),M.push(i+o*y);for(u=0;u<a;u++)for(c=0;c<s;c++)b=(w=u*(s+1)+c)+s+1,A.push(w+1),A.push(b+1),A.push(b),A.push(w+1),A.push(b),A.push(w);return{primitiveType:"triangles",positions:M,normals:I,uv:T,uvs:T,indices:A}}function Xr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.radius||1;t<0&&(console.error("negative radius not allowed - will invert"),t*=-1),t*=.5;var r=e.tube||.3;r<0&&(console.error("negative tube not allowed - will invert"),r*=-1);var n=e.radialSegments||32;n<0&&(console.error("negative radialSegments not allowed - will invert"),n*=-1),n<4&&(n=4);var i=e.tubeSegments||24;i<0&&(console.error("negative tubeSegments not allowed - will invert"),i*=-1),i<4&&(i=4);var o=e.arc||2*Math.PI;o<0&&(console.warn("negative arc not allowed - will invert"),o*=-1),o>360&&(o=360);var a,s,u,c,l,h,f,d,p,v,m,y,g=e.center,x=g?g[0]:0,w=g?g[1]:0,b=g?g[2]:0,M=[],I=[],T=[],A=[];for(d=0;d<=i;d++)for(f=0;f<=n;f++)a=f/n*o,s=.785398+d/i*Math.PI*2,x=t*Math.cos(a),w=t*Math.sin(a),u=(t+r*Math.cos(s))*Math.cos(a),c=(t+r*Math.cos(s))*Math.sin(a),l=r*Math.sin(s),M.push(u+x),M.push(c+w),M.push(l+b),T.push(1-f/n),T.push(d/i),h=k.normalizeVec3(k.subVec3([u,c,l],[x,w,b],[]),[]),I.push(h[0]),I.push(h[1]),I.push(h[2]);for(d=1;d<=i;d++)for(f=1;f<=n;f++)p=(n+1)*d+f-1,v=(n+1)*(d-1)+f-1,m=(n+1)*(d-1)+f,y=(n+1)*d+f,A.push(p),A.push(v),A.push(m),A.push(m),A.push(y),A.push(p);return{primitiveType:"triangles",positions:M,normals:I,uv:T,uvs:T,indices:A}}var Rr={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};function Kr(){for(var e,t,r,n,i,o,a,s,u,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=c.origin||[0,0,0],h=l[0],f=l[1],d=l[2],p=c.size||1,v=[],m=[],y=(""+c.text).trim(),g=(y||"").split("\n"),x=0,w=0,b=.04,M=0;M<g.length;M++){e=0,r=(t=g[M]).length;for(var I=0;I<r;I++)if(n=Rr[t.charAt(I)]){i=1,o=-1,a=-1,s=n.points.length;for(var T=0;T<s;T++)-1!==(u=n.points[T])[0]||-1!==u[1]?(v.push(e+u[0]*p*b+h),v.push(w+u[1]*p*b+f),v.push(0+d),-1===o?o=x:(-1===a||(o=a),a=x),x++,i?i=!1:(m.push(o),m.push(a))):i=1;e+=n.width*b*p}w-=35*b*p}return{primitiveType:"lines",positions:v,indices:m}}function qr(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;++n)r[n]=e[n];return t}function Zr(e){return Zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zr(e)}function Yr(){Yr=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof h?t:h,o=Object.create(i.prototype),a=new I(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function h(){}function f(){}function d(){}var p={};s(p,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(T([])));m&&m!==t&&r.call(m,i)&&(p=m);var y=d.prototype=h.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(i,o,a,s){var u=c(e[i],e,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==Zr(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=d,s(y,"constructor",d),s(d,"constructor",f),f.displayName=s(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},g(x.prototype),s(x.prototype,o,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new x(u(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(y),s(y,a,"Generator"),s(y,i,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;M(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function Qr(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}var Wr=r(231);function Jr(e){var t=e.WebIFC,r=e.source,n=e.sourceData,i=e.sourceFormat,o=e.metaModelSource,a=e.metaModelData,s=e.output,u=e.outputXKTModel,c=e.outputXKT,l=e.includeTypes,h=e.excludeTypes,d=e.reuseGeometries,p=void 0===d||d,v=e.minTileSize,m=void 0===v?200:v,y=e.stats,g=void 0===y?{}:y,x=e.outputStats,w=e.rotateX,b=void 0!==w&&w,M=e.includeTextures,I=void 0===M||M,T=e.includeNormals,A=void 0===T||T,S=e.log,O=void 0===S?function(e){}:S;return g.sourceFormat="",g.schemaVersion="",g.title="",g.author="",g.created="",g.numMetaObjects=0,g.numPropertySets=0,g.numTriangles=0,g.numVertices=0,g.numNormals=0,g.numUVs=0,g.numTextures=0,g.numTextureSets=0,g.numObjects=0,g.numGeometries=0,g.sourceSize=0,g.xktSize=0,g.texturesSize=0,g.xktVersion="",g.compressionRatio=0,g.conversionTime=0,g.aabb=null,g.minTileSize=m||200,new Promise((function(e,d){var v=O;if(O=function(e){v("[convert2xkt] ".concat(e))},r||n)if(i||!n)if(s||u||c){r&&O("Reading input file: "+r);var y=new Date,w=i||r.split(".").pop();if(!n)try{n=Wr.readFileSync(r)}catch(e){return void d(e)}var M=n.byteLength;if(O("Input file size: "+(M/1e3).toFixed(2)+" kB"),!a&&o){O("Reading input metadata file: "+o);try{a=Wr.readFileSync(o)}catch(e){return void d(e)}}!1===p&&O("Geometry reuse is disabled");var T,S,L=new Re({minTileSize:m}),P=function(e){try{return JSON.parse(e)}catch(e){O("Error parsing metadata JSON: ".concat(e))}};switch(w){case"json":G(Pt,{data:JSON.parse(n),xktModel:L,stats:g,rotateX:b,log:O});break;case"glb":G(Bt,{data:n=qr(n),reuseGeometries:p,includeTextures:I,includeNormals:A,metaModelData:a?P(a):null,xktModel:L,stats:g,log:O});break;case"gltf":var E=JSON.parse(n),j=r?Hr(r):"";G(Jt,{baseUri:j,data:E,reuseGeometries:p,includeTextures:I,includeNormals:A,metaModelData:a?P(a):null,xktModel:L,getAttachment:(T=Yr().mark((function e(t){var r,n,i;return Yr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O("Reading attachment file: ".concat(r=j+t)),n=Wr.readFileSync(r),i=qr(n),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})),S=function(){var e=this,t=arguments;return new Promise((function(r,n){var i=T.apply(e,t);function o(e){Qr(i,r,n,o,a,"next",e)}function a(e){Qr(i,r,n,o,a,"throw",e)}o(void 0)}))},function(e){return S.apply(this,arguments)}),stats:g,log:O});break;case"ifc":G(ar,{WebIFC:t,data:n,xktModel:L,wasmPath:"./",includeTypes:l,excludeTypes:h,stats:g,log:O});break;case"laz":G(hr,{data:n,xktModel:L,stats:g,rotateX:b,log:O});break;case"las":G(hr,{data:n,xktModel:L,stats:g,log:O});break;case"pcd":G(mr,{data:n,xktModel:L,stats:g,log:O});break;case"ply":G(Mr,{data:n,xktModel:L,stats:g,log:O});break;case"stl":G(Lr,{data:n,xktModel:L,stats:g,log:O});break;default:return void d('Error: unsupported source format: "'.concat(w,'".'))}}else d("Argument expected: output, outputXKTModel or outputXKT");else d("Argument expected: sourceFormat is required with sourceData");else d("Argument expected: source or sourceData");function G(t,r){t(r).then((function(){a||L.createDefaultMetaObjects(),O("Input file parsed OK. Building XKT document..."),L.finalize().then((function(){O("XKT document built OK. Writing to XKT file...");var t=Ze(L,a,g),r=Buffer.from(t),n=t.byteLength;if(g.sourceSize=(M/1e3).toFixed(2),g.xktSize=(n/1e3).toFixed(2),g.xktVersion=f.xktVersion,g.compressionRatio=(M/n).toFixed(2),g.conversionTime=((new Date-y)/1e3).toFixed(2),g.aabb=L.aabb,O("Converted to: XKT v".concat(g.xktVersion)),l&&O("Include types: "+(l||"(include all)")),h&&O("Exclude types: "+(h||"(exclude none)")),O("XKT size: "+g.xktSize+" kB"),O("XKT textures size: "+(g.texturesSize/1e3).toFixed(2)+"kB"),O("Compression ratio: "+g.compressionRatio),O("Conversion time: "+g.conversionTime+" s"),O("Converted metaobjects: "+g.numMetaObjects),O("Converted property sets: "+g.numPropertySets),O("Converted drawable objects: "+g.numObjects),O("Converted geometries: "+g.numGeometries),O("Converted textures: "+g.numTextures),O("Converted textureSets: "+g.numTextureSets),O("Converted triangles: "+g.numTriangles),O("Converted vertices: "+g.numVertices),O("Converted UVs: "+g.numUVs),O("Converted normals: "+g.numNormals),O("minTileSize: "+g.minTileSize),s){var i=Hr(s).trim();""===i||Wr.existsSync(i)||Wr.mkdirSync(i,{recursive:!0}),O("Writing XKT file: "+s),Wr.writeFileSync(s,r)}u&&u(L),c&&c(r),x&&x(g),e()}))}),(function(e){d(e)}))}}))}function Hr(e){var t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}(0,e.installFilePolyfills)()})(),n})()));
//# sourceMappingURL=xeokit-convert.cjs.js.map